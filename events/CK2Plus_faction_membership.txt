namespace = PlusFaction

#reserved: PlusFaction.100 to PlusFaction.199

##################################
# FACTION MEMBERSHIP EVENTS
# Original Faction System by Wiz
# Re-Written by Rylock
##################################

### FACTION RECRUITMENT EVENTS

# Faction leader sets out to recruit a fellow vassal
character_event = {
	id = PlusFaction.110
	desc = EVTDESC_PlusFaction_110
	picture = GFX_evt_carriage

	is_triggered_only = yes

	option = {
		name = OK

		add_character_modifier = {
			name = do_not_disturb
			days = 15
			hidden = yes
		}
	}
}

# Faction leader tries to recruit fellow vassal
character_event = {
	id = PlusFaction.111
	picture = GFX_evt_shadowy_cabal

	desc = {
		text = EVTDESC_PlusFaction_111A
		trigger = { FROMFROM = { leads_faction = faction_court } }
	}
	desc = {
		text = EVTDESC_PlusFaction_111B
		trigger = { FROMFROM = { leads_faction = faction_prosperity } }
	}
	desc = {
		text = EVTDESC_PlusFaction_111C
		trigger = { FROMFROM = { leads_faction = faction_glory } }
	}
	desc = {
		text = EVTDESC_PlusFaction_111D
		trigger = { FROMFROM = { leads_faction = faction_tradition } }
	}

	is_triggered_only = yes

	trigger = {
		FROMFROM = { pf_leader_trigger = yes }
		pf_leader_trigger = no
	}

	immediate = {
		trigger_switch = {
			on_trigger = in_faction

			faction_court = {
				liege = {
					random_vassal = {
						limit = { leads_faction = faction_court }
						save_event_target_as = target_faction_leader
					}
				}
			}

			faction_prosperity = {
				liege = {
					random_vassal = {
						limit = { leads_faction = faction_prosperity }
						save_event_target_as = target_faction_leader
					}
				}
			}

			faction_glory = {
				liege = {
					random_vassal = {
						limit = { leads_faction = faction_glory }
						save_event_target_as = target_faction_leader
					}
				}
			}

			faction_tradition = {
				liege = {
					random_vassal = {
						limit = { leads_faction = faction_tradition }
						save_event_target_as = target_faction_leader
					}
				}
			}
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_111 # Agree to join his faction

		trigger = {
			ai = yes
			pf_member_trigger = yes

			FROMFROM = {
				trigger_if = {
					limit = { leads_faction = faction_court }
					ROOT = { NOT = { in_faction = faction_court } }
				}
				trigger_else_if = {
					limit = { leads_faction = faction_prosperity }
					ROOT = { NOT = { in_faction = faction_prosperity } }
				}
				trigger_else_if = {
					limit = { leads_faction = faction_glory }
					ROOT = { NOT = { in_faction = faction_glory } }
				}
				trigger_else = {
					leads_faction = faction_tradition
					ROOT = {
						religion = FROMFROM

						NOR = {
							in_faction = faction_tradition
							trait = excommunicated
							trait = cynical
						}
					}
				}
			}
		}

		pf_leave_faction_effect = yes
		FROMFROM = { save_event_target_as = pf_leader }
		pf_join_leader_effect = yes

		opinion = {
			name = pleasant_meeting
			who = FROMFROM
			multiplier = 2
			years = 5
		}

		FROMFROM = {
			character_event = { id = PlusFaction.112 }
		}

		random = {
			chance = 50

			mult_modifier = {
				factor = 0.75
				event_target:target_faction_leader = { intrigue < 3 }
			}

			mult_modifier = {
				factor = 0.75
				event_target:target_faction_leader = { intrigue < 6 }
			}

			mult_modifier = {
				factor = 1.25
				event_target:target_faction_leader = { intrigue >= 10 }
			}

			mult_modifier = {
				factor = 1.25
				event_target:target_faction_leader = { intrigue >= 15 }
			}

			event_target:target_faction_leader = {
				character_event = { id = PlusFaction.113 } # Learns about poaching
			}
		}

		ai_chance = {
			factor = 50

			trigger = {
				opinion = {
					who = FROMFROM
					value >= 0
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = charitable
					trait = humble
					trait = content
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = ambitious
					trait = proud
					trait = greedy
					trait = envious
					trait = gluttonous
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = charitable
					trait = slothful
					trait = trusting
					is_theocracy = yes
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = greedy
					trait = diligent
					trait = gardener
					trait = administrator
					trait = architect
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = kind
					trait = patient
					trait = craven
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = brave
					trait = wroth
					trait = cruel
					trait = hunter
					trait = duelist
					trait = impaler
					trait = strategist
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = proud
					is_republic = yes
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_tradition }
				trait = zealous
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = content
					trait = humble
					trait = temperate
					trait = hafiz
					trait = faqih
					trait = theologian
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					is_republic = yes
					trait = greedy
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					is_theocracy = yes
					trait = zealous
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = amateurish_plotter
					trait = flamboyant_schemer
					trait = intricate_webweaver
					trait = elusive_shadow
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = indulgent_wastrel
					trait = thrifty_clerk
					trait = fortune_builder
					trait = midas_touched
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = misguided_warrior
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = detached_priest
					trait = dutiful_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
				}
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy < 3 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy < 5 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 14 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 16 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 18 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 20 }
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = FROMFROM
					value >= 25
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = FROMFROM
					value >= 50
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = FROMFROM
					value >= 75
				}
			}

			mult_modifier = {
				factor = 0.6

				opinion = {
					who = event_target:target_faction_leader
					value >= 25
				}
			}

			mult_modifier = {
				factor = 0.6

				opinion = {
					who = event_target:target_faction_leader
					value >= 50
				}
			}

			mult_modifier = {
				factor = 0.6

				opinion = {
					who = event_target:target_faction_leader
					value >= 75
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = event_target:target_faction_leader
					value < -25
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = event_target:target_faction_leader
					value < -50
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = event_target:target_faction_leader
					value < -75
				}
			}

			mult_modifier = {
				factor = 0.5

				likes_better_than = {
					who = event_target:target_faction_leader
					than = FROMFROM
				}
			}
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_111 # Agree to join his faction

		trigger = {
			ai = yes
			pf_member_trigger = no

			FROMFROM = {
				trigger_if = {
					limit = { leads_faction = faction_court }
					ROOT = { NOT = { in_faction = faction_court } }
				}
				trigger_else_if = {
					limit = { leads_faction = faction_prosperity }
					ROOT = { NOT = { in_faction = faction_prosperity } }
				}
				trigger_else_if = {
					limit = { leads_faction = faction_glory }
					ROOT = { NOT = { in_faction = faction_glory } }
				}
				trigger_else = {
					leads_faction = faction_tradition

					ROOT = {
						religion = FROMFROM

						NOR = {
							in_faction = faction_tradition
							trait = excommunicated
							trait = cynical
						}
					}
				}
			}
		}

		FROMFROM = { save_event_target_as = pf_leader }
		pf_join_leader_effect = yes

		opinion = {
			name = pleasant_meeting
			who = FROMFROM
			multiplier = 2
			years = 5
		}

		FROMFROM = {
			character_event = { id = PlusFaction.112 }
		}

		ai_chance = {
			factor = 30

			trigger = {
				opinion = {
					who = FROMFROM
					value >= 0
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = charitable
					trait = humble
					trait = content
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = ambitious
					trait = proud
					trait = greedy
					trait = envious
					trait = gluttonous
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = charitable
					trait = slothful
					trait = trusting
					capital_holding = { holding_type = temple }
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = greedy
					trait = diligent
					trait = gardener
					trait = administrator
					trait = architect
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = kind
					trait = patient
					trait = craven
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = brave
					trait = wroth
					trait = cruel
					trait = hunter
					trait = duelist
					trait = impaler
					trait = strategist
				}
			}

			mult_modifier = {
				factor = 0.5

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = proud
					is_republic = yes
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_tradition }

				trait = zealous
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = content
					trait = humble
					trait = temperate
					trait = hafiz
					trait = faqih
					trait = theologian
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = greedy
					is_republic = yes
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					is_theocracy = yes
					trait = zealous
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = amateurish_plotter
					trait = flamboyant_schemer
					trait = intricate_webweaver
					trait = elusive_shadow
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = indulgent_wastrel
					trait = thrifty_clerk
					trait = fortune_builder
					trait = midas_touched
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = misguided_warrior
					trait = tough_soldier
					trait = skilled_tactician
					trait = brilliant_strategist
				}
			}

			mult_modifier = {
				factor = 1.2

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = detached_priest
					trait = dutiful_cleric
					trait = scholarly_theologian
					trait = mastermind_theologian
				}
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy < 3 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy < 5 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 14 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 16 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 18 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 20 }
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = FROMFROM
					value >= 25
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = FROMFROM
					value >= 50
				}
			}

			mult_modifier = {
				factor = 1.2

				opinion = {
					who = FROMFROM
					value >= 75
				}
			}
		}
	}

	option = {
		name = EVTOPTB_PlusFaction_111 # Have a pleasant chat, but promise nothing

		opinion = {
			name = pleasant_meeting
			who = FROMFROM
			years = 5
		}

		FROMFROM = {
			character_event = { id = PlusFaction.114 }
		}

		ai_chance = {
			factor = 100

			mult_modifier = {
				factor = 0.75

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = charitable
					trait = humble
					trait = content
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_court }

				OR = {
					trait = ambitious
					trait = proud
					trait = greedy
					trait = envious
					trait = gluttonous
				}
			}

			mult_modifier = {
				factor = 0.75

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = charitable
					trait = slothful
					trait = trusting
					capital_holding = { holding_type = temple }
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = greedy
					trait = diligent
					trait = gardener
					trait = administrator
					trait = architect
				}
			}

			mult_modifier = {
				factor = 0.75

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = kind
					trait = patient
					trait = craven
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_glory }

				OR = {
					trait = brave
					trait = wroth
					trait = cruel
					trait = hunter
					trait = duelist
					trait = impaler
					trait = strategist
				}
			}

			mult_modifier = {
				factor = 0.75

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = proud
					is_republic = yes
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					trait = zealous
					trait = content
					trait = humble
					trait = temperate
					trait = hafiz
					trait = faqih
					trait = theologian
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_prosperity }

				OR = {
					trait = greedy
					is_republic = yes
				}
			}

			mult_modifier = {
				factor = 1.5

				FROMFROM = { leads_faction = faction_tradition }

				OR = {
					is_theocracy = yes
					trait = zealous
				}
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy < 3 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy < 5 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 14 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 16 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 18 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy >= 20 }
			}
		}
	}

	option = {
		name = {
			text = EVTOPTC_PlusFaction_111 # Send him away, but tell no-one
			trigger = { pf_member_trigger = yes }
		}
		name = {
			text = EVTOPTD_PlusFaction_111 # Send him on his way
			trigger = { pf_member_trigger = no }
		}

		opinion = {
			name = unpleasant_meeting
			who = FROMFROM
			years = 5
		}

		FROMFROM = {
			character_event = { id = PlusFaction.115 }
		}

		ai_chance = {
			factor = 100

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy < 3 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy < 5 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 14 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 16 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 18 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 20 }
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROMFROM
					value < -25
				}
			}

			mult_modifier = {
				factor = 1.5

				opinion = {
					who = FROMFROM
					value < 0
				}
			}

			mult_modifier = {
				factor = 0.8

				opinion = {
					who = FROMFROM
					value >= 25
				}
			}

			mult_modifier = {
				factor = 0.8

				opinion = {
					who = FROMFROM
					value >= 50
				}
			}

			mult_modifier = {
				factor = 0.8

				opinion = {
					who = FROMFROM
					value >= 75
				}
			}

			mult_modifier = {
				factor = 0.5
				pf_member_trigger = no
			}
		}
	}

	option = {
		name = EVTOPTE_PlusFaction_111 # Send him away and tell faction leader

		trigger = { pf_member_trigger = yes }

		opinion = {
			name = unpleasant_meeting
			who = FROMFROM
			years = 5
			multiplier = 2
		}

		event_target:target_faction_leader = {
			show_scope_change = no

			letter_event = {
				id = PlusFaction.117
				tooltip = INFORM_FACTION_LEADER
			}
		}

		FROMFROM = {
			character_event = { id = PlusFaction.116 }
		}

		ai_chance = {
			factor = 50

			trigger = {
				opinion = {
					who = event_target:target_faction_leader
					value >= -50
				}
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy < 3 }
			}

			mult_modifier = {
				factor = 1.1
				FROMFROM = { diplomacy < 5 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 14 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 16 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 18 }
			}

			mult_modifier = {
				factor = 0.9
				FROMFROM = { diplomacy >= 20 }
			}

			mult_modifier = {
				factor = 2

				opinion = {
					who = FROMFROM
					value < -25
				}
			}

			mult_modifier = {
				factor = 1.5

				opinion = {
					who = FROMFROM
					value < 0
				}
			}

			mult_modifier = {
				factor = 0.6

				opinion = {
					who = FROMFROM
					value = 25
				}
			}

			mult_modifier = {
				factor = 0.6

				opinion = {
					who = FROMFROM
					value >= 50
				}
			}

			mult_modifier = {
				factor = 0.6

				opinion = {
					who = FROMFROM
					value >= 75
				}
			}

			mult_modifier = {
				factor = 1.5

				opinion = {
					who = event_target:target_faction_leader
					value >= 25
				}
			}

			mult_modifier = {
				factor = 1.5

				opinion = {
					who = event_target:target_faction_leader
					value >= 50
				}
			}

			mult_modifier = {
				factor = 1.5

				opinion = {
					who = event_target:target_faction_leader
					value >= 75
				}
			}

			mult_modifier = {
				factor = 0.5

				opinion = {
					who = event_target:target_faction_leader
					value < -25
				}
			}
		}
	}
}

# Ruler agreed to join the faction
character_event = {
	id = PlusFaction.112
	desc = EVTDESC_PlusFaction_112
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes

	option = {
		name = EXCELLENT

		opinion = {
			name = pleasant_meeting
			who = FROM
			years = 5
			multiplier = 2
		}
	}
}

# Ruler's faction leader learned about the poaching
character_event = {
	id = PlusFaction.113
	desc = EVTDESC_PlusFaction_113
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_113

		opinion = {
			name = opinion_disappointed
			who = FROM
			years = 5
		}

		opinion = {
			name = poached_faction_member
			who = FROMFROMFROM
			years = 5
		}
	}
}

# Ruler refused to join the faction, but the meeting went well
character_event = {
	id = PlusFaction.114
	desc = EVTDESC_PlusFaction_114
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_114

		opinion = {
			name = pleasant_meeting
			who = FROM
			years = 5
		}
	}
}

# Faction leader was sent away
character_event = {
	id = PlusFaction.115
	desc = EVTDESC_PlusFaction_115
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes

	option = {
		name = CURSES

		opinion = {
			name = opinion_rebuffed_recruitment
			who = FROM
			years = 5
		}
	}
}

# Faction leader was sent away and own faction told
character_event = {
	id = PlusFaction.116
	desc = EVTDESC_PlusFaction_116
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes

	option = {
		name = CURSES

		opinion = {
			name = opinion_rebuffed_recruitment
			who = FROM
			years = 10
		}
	}
}

# Ruler's own faction leader informed about the poaching attempt
letter_event = {
	id = PlusFaction.117
	desc = EVTDESC_PlusFaction_117

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_113

		opinion = {
			name = opinion_pleased
			who = FROM
			years = 5
		}

		opinion = {
			name = attempted_poach_faction
			who = FROMFROMFROM
			years = 10
		}
	}
}

### FACTION DISPUTE EVENTS

# Faction member has a dispute with faction leader
character_event = {
	id = PlusFaction.120
	desc = EVTDESC_PlusFaction_120
	picture = GFX_evt_rival_rulers

	is_triggered_only = yes

	only_playable = yes
	min_age = 16
	only_capable = yes
	prisoner = no
	war = no
	is_sick = no

	trigger = {
		pf_leader_trigger = yes
		is_inaccessible_trigger = no

		liege = {
			any_vassal = {
				pf_root_faction_backer_trigger = yes
				ai = yes
				is_adult = yes
				prisoner = no
				is_ill = no
				is_incapable = no
				war = no
				NOT = { character = ROOT }
				is_inaccessible_trigger = no

				opinion = {
					who = ROOT
					value < 0
				}
			}
		}

		trigger_if = {
			limit = { has_character_flag = had_faction_dispute }

			had_character_flag = {
				flag = had_faction_dispute
				years >= 5
			}
		}
	}

	weight_multiplier = {
		days = 1

		mult_modifier = {
			factor = 1.5

			liege = {
				any_vassal = {
					pf_root_faction_backer_trigger = yes
					ai = yes
					is_adult = yes
					prisoner = no
					is_ill = no
					war = no
					is_incapable = no
					NOT = { character = ROOT }
					is_inaccessible_trigger = no

					opinion = {
						who = ROOT
						value < -50
					}
				}
			}
		}
	}

	immediate = {
		set_character_flag = had_faction_dispute

		liege = {
			random_vassal = {
				limit = {
					pf_root_faction_backer_trigger = yes
					ai = yes
					is_adult = yes
					war = no
					prisoner = no
					is_ill = no
					is_incapable = no
					NOT = { character = ROOT }
					is_inaccessible_trigger = no

					opinion = {
						who = ROOT
						value < 0
					}
				}

				preferred_limit = {
					opinion = {
						who = ROOT
						value < -50
					}
				}

				save_event_target_as = target_faction_dispute
			}
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_120 # So be it

		reverse_opinion = {
			name = opinion_dispute
			who = event_target:target_faction_dispute
			years = 5
		}

		hidden_effect = {
			opinion = {
				name = opinion_dispute
				who = event_target:target_faction_dispute
				years = 5
			}
		}
	}

	option = {
		name = EVTOPTB_PlusFaction_120 # Try to sweet talk him
		tooltip_info = diplomacy

		trigger = { diplomacy >= 12 }

		random_list = {
			50 = {
				mult_modifier = {
					factor = 1.2
					diplomacy >= 14
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 16
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 18
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 20
				}

				custom_tooltip = {
					text = SMOOTH_THINGS_OVER
					clr_character_flag = had_faction_dispute
				}
			}

			50 = {
				reverse_opinion = {
					name = opinion_dispute
					who = event_target:target_faction_dispute
					years = 5
				}
			}

			10 = {
				custom_tooltip = { text = MAKE_THINGS_WORSE }

				reverse_opinion = {
					name = opinion_dispute
					who = event_target:target_faction_dispute
					years = 5
					multiplier = 2
				}
			}
		}
	}

	option = {
		name = EVTOPTC_PlusFaction_120 # Put him in his place
		tooltip_info = intrigue

		trigger = {
			intrigue >= 12
			higher_real_tier_than = event_target:target_faction_dispute
		}

		random_list = {
			50 = {
				mult_modifier = {
					factor = 1.2
					intrigue >= 14
				}

				mult_modifier = {
					factor = 1.2
					intrigue >= 16
				}

				mult_modifier = {
					factor = 1.2
					intrigue >= 18
				}

				mult_modifier = {
					factor = 1.2
					intrigue >= 20
				}

				custom_tooltip = {
					text = SMOOTH_THINGS_OVER
					clr_character_flag = had_faction_dispute
				}
			}

			50 = {
				reverse_opinion = {
					name = opinion_dispute
					who = event_target:target_faction_dispute
					years = 5
				}
			}

			10 = {
				custom_tooltip = { text = MAKE_THINGS_WORSE }

				reverse_opinion = {
					name = opinion_dispute
					who = event_target:target_faction_dispute
					years = 5
					multiplier = 2
				}
			}
		}
	}

	after = {
		hidden_effect = {
			if = {
				limit = { has_character_flag = had_faction_dispute }

				event_target:target_faction_dispute = {
					if = {
						limit = { is_rival = ROOT }
						pf_leave_faction_effect = yes
					}
					else_if = {
						limit = {
							opinion = {
								who = ROOT
								value < -50
							}
						}

						random_list = {
							50 = { add_rival = ROOT }
							50 = { pf_leave_faction_effect = yes }
						}
					}
				}
			}
		}
	}
}

### FACTION COURTING EVENTS

# Faction member begins to court another faction member
character_event = {
	id = PlusFaction.125
	picture = GFX_evt_shadowy_cabal

	desc = {
		text = EVTDESC_PlusFaction_125A
		trigger = { in_faction = faction_court }
	}
	desc = {
		text = EVTDESC_PlusFaction_125B
		trigger = { in_faction = faction_prosperity }
	}
	desc = {
		text = EVTDESC_PlusFaction_125C
		trigger = { in_faction = faction_glory }
	}
	desc = {
		text = EVTDESC_PlusFaction_125D
		trigger = { in_faction = faction_tradition }
	}

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = EVTOPTA_PlusFaction_125

		random_list = {
			40 = {
				mult_modifier = {
					factor = 1.2
					diplomacy >= 12
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 14
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 16
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 18
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 20
				}

				mult_modifier = {
					factor = 1.5

					OR = {
						dynasty = FROM
						is_close_relative = FROM
						is_lover = FROM
						is_married = FROM
					}
				}

				mult_modifier = {
					factor = 1.2

					OR = {
						trait = trusting
						FROM = { trait = trusting }
					}
				}

				mult_modifier = {
					factor = 0.8
					trait = greedy
					FROM = { trait = charitable }
				}

				mult_modifier = {
					factor = 0.8
					trait = charitable
					FROM = { trait = greedy }
				}

				mult_modifier = {
					factor = 0.8
					trait = kind
					FROM = { trait = cruel }
				}

				mult_modifier = {
					factor = 0.8
					trait = cruel
					FROM = { trait = kind }
				}

				mult_modifier = {
					factor = 0.8
					trait = deceitful
					FROM = { trait = honest }
				}

				mult_modifier = {
					factor = 0.8
					trait = honest
					FROM = { trait = deceitful }
				}

				mult_modifier = {
					factor = 0.8
					trait = zealous
					FROM = { trait = cynical }
				}

				mult_modifier = {
					factor = 0.8
					trait = cynical
					FROM = { trait = zealous }
				}

				mult_modifier = {
					factor = 0.8
					trait = just
					FROM = { trait = arbitrary }
				}

				mult_modifier = {
					factor = 0.8
					trait = arbitrary
					FROM = { trait = just }
				}

				mult_modifier = {
					factor = 0.8

					OR = {
						trait = paranoid
						FROM = { trait = paranoid }
					}
				}

				mult_modifier = {
					factor = 0.8

					OR = {
						trait = shy
						FROM = { trait = shy }
					}
				}

				character_event = {
					id = PlusFaction.126
					days = 15
					tooltip = COURT_GOOD_MEETING
				}
			}

			40 = {
				character_event = {
					id = PlusFaction.127
					days = 15
					tooltip = COURT_NOTHING_HAPPENS
				}
			}

			20 = {
				mult_modifier = {
					factor = 2

					FROM = {
						any_claim = { holder = ROOT }
					}
				}

				mult_modifier = {
					factor = 2

					OR = {
						trait = lunatic
						trait = possessed

						FROM = {
							OR = {
								trait = lunatic
								trait = possessed
							}
						}
					}
				}

				mult_modifier = {
					factor = 1.5
					NOT = { culture = FROM }
				}

				mult_modifier = {
					factor = 2
					NOT = { culture_group = FROM }
				}

				mult_modifier = {
					factor = 1.5
					NOT = { religion = FROM }
				}

				mult_modifier = {
					factor = 2
					NOT = { religion_group = FROM }
				}

				mult_modifier = {
					factor = 1.5

					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 8
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 6
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 4
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 2
				}

				mult_modifier = {
					factor = 0.8

					opinion = {
						who = FROM
						value >= 0
					}

					reverse_opinion = {
						who = FROM
						value >= 0
					}
				}

				mult_modifier = {
					factor = 0.8

					opinion = {
						who = FROM
						value >= 25
					}

					reverse_opinion = {
						who = FROM
						value >= 25
					}
				}

				character_event = {
					id = PlusFaction.128
					days = 15
					tooltip = COURT_POOR_MEETING
				}
			}
		}
	}
}

# The meeting with the faction member goes well
character_event = {
	id = PlusFaction.126
	desc = EVTDESC_PlusFaction_126
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = EXCELLENT

		prestige = 25

		random_list = {
			75 = {
				reverse_opinion = {
					name = pleasant_meeting
					who = FROMFROM
					years = 5
				}
			}

			25 = {
				mult_modifier = {
					factor = 1.2
					diplomacy >= 12
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 14
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 16
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 18
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 20
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 8
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 6
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 4
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 2
				}

				reverse_opinion = {
					name = pleasant_meeting
					who = FROMFROM
					years = 5
					multiplier = 2
				}
			}
		}
	}
}

# The meeting with the faction member produces no results
character_event = {
	id = PlusFaction.127
	desc = EVTDESC_PlusFaction_127
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes
	show_from_from = yes

	ai = no

	option = {
		name = OK
	}
}

# The meeting with the faction member goes poorly
character_event = {
	id = PlusFaction.128
	desc = EVTDESC_PlusFaction_128
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = CURSES

		prestige = -25

		random_list = {
			75 = {
				reverse_opinion = {
					name = unpleasant_meeting
					who = FROMFROM
					years = 5
				}
			}

			25 = {
				mult_modifier = {
					factor = 0.8
					diplomacy >= 12
				}

				mult_modifier = {
					factor = 0.8
					diplomacy >= 14
				}

				mult_modifier = {
					factor = 0.8
					diplomacy >= 16
				}

				mult_modifier = {
					factor = 0.8
					diplomacy >= 18
				}

				mult_modifier = {
					factor = 0.8
					diplomacy >= 20
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 8
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 6
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 4
				}

				mult_modifier = {
					factor = 1.2
					diplomacy < 2
				}

				reverse_opinion = {
					name = unpleasant_meeting
					who = FROMFROM
					years = 5
					multiplier = 2
				}
			}
		}
	}
}

### SEEKING SUPPORT FOR A PRETENDER

# Ruler approaches fellow vassal to seek support for a claimant
character_event = {
	id = PlusFaction.130
	picture = GFX_evt_shadowy_cabal

	desc = {
		text = EVTDESC_PlusFaction_130A
		trigger = { character = event_target:target_claimant }
	}
	desc = {
		text = EVTDESC_PlusFaction_130B
		trigger = {
			NOT = { character = event_target:target_claimant }
		}
	}

	is_triggered_only = yes
	show_from_from = yes

	immediate = {
		supported_claimant = { save_event_target_as = target_claimant }

		supported_claimant_title = {
			save_event_target_as = target_claimed_title
			holder_scope = { save_event_target_as = target_title_holder }
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_130

		random_list = {
			60 = {
				mult_modifier = {
					factor = 0.5

					FROM = {
						NOR = {
							dynasty = event_target:target_claimant
							is_close_relative = event_target:target_claimant
							any_spouse = { dynasty = event_target:target_claimant }
						}
					}
				}

				mult_modifier = {
					factor = 1.5

					FROM = {
						is_close_relative = event_target:target_claimant
						NOT = { is_close_relative = event_target:target_title_holder }
					}
				}

				mult_modifier = {
					factor = 1.25

					FROM = {
						NOT = { is_close_relative = event_target:target_claimant }
						dynasty = event_target:target_claimant
						NOT = { dynasty = event_target:target_title_holder }
					}
				}

				mult_modifier = {
					factor = 0.75

					FROM = {
						NOT = { dynasty = event_target:target_claimant }
						dynasty = event_target:target_title_holder
					}
				}

				mult_modifier = {
					factor = 0.75

					FROM = {
						NOT = { culture = event_target:target_claimant }
					}
				}

				mult_modifier = {
					factor = 1.5

					FROM = {
						culture = event_target:target_claimant
						NOT = { culture = event_target:target_title_holder }
					}
				}

				mult_modifier = {
					factor = 2

					FROM = {
						NOT = { religion = event_target:target_title_holder }
					}
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 8
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 6
				}

				mult_modifier = {
					factor = 0.8
					diplomacy < 4
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 12
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 14
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 16
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 18
				}

				mult_modifier = {
					factor = 1.2
					diplomacy >= 20
				}

				mult_modifier = {
					factor = 0.5

					reverse_opinion = {
						who = FROM
						value < -75
					}
				}

				mult_modifier = {
					factor = 0.5

					reverse_opinion = {
						who = FROM
						value < -50
					}
				}

				mult_modifier = {
					factor = 0.5

					reverse_opinion = {
						who = FROM
						value < -25
					}
				}

				mult_modifier = {
					factor = 0.8

					reverse_opinion = {
						who = FROM
						value < 0
					}
				}

				mult_modifier = {
					factor = 1.2

					reverse_opinion = {
						who = FROM
						value >= 25
					}
				}

				mult_modifier = {
					factor = 1.2

					reverse_opinion = {
						who = FROM
						value >= 50
					}
				}

				mult_modifier = {
					factor = 1.2

					reverse_opinion = {
						who = FROM
						value >= 75
					}
				}

				mult_modifier = {
					factor = 1.2

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value < -75
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value < -50
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value < -25
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value >= 0
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value >= 25
						}
					}
				}

				mult_modifier = {
					factor = 0.5

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value >= 50
						}
					}
				}

				mult_modifier = {
					factor = 0.5

					FROM = {
						opinion = {
							who = event_target:target_title_holder
							value >= 75
						}
					}
				}

				character_event = {
					id = PlusFaction.131
					days = 15
					tooltip = RULER_SUPPORTS_CLAIMANT
				}
			}

			30 = {
				character_event = {
					id = PlusFaction.132
					days = 15
					tooltip = COURT_NOTHING_HAPPENS
				}
			}

			10 = {
				character_event = {
					id = PlusFaction.133
					days = 15
					tooltip = COURT_POOR_MEETING
				}
			}
		}
	}
}

# Fellow vassal is convinced to support the claimant
character_event = {
	id = PlusFaction.131
	picture = GFX_evt_shadowy_cabal

	desc = {
		text = EVTDESC_PlusFaction_131A
		trigger = { character = event_target:target_claimant }
	}
	desc = {
		text = EVTDESC_PlusFaction_131B
		trigger = {
			NOT = { character = event_target:target_claimant }
		}
	}

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = EXCELLENT

		prestige = 25

		FROMFROM = {
			show_scope_change = no

			opinion = {
				name = opinion_support_claimant
				who = event_target:target_claimant
				years = 5
			}

			if = {
				limit = {
					event_target:target_claimant = {
						NOT = { character = ROOT }
					}
				}

				opinion = {
					name = pleasant_meeting
					who = ROOT
					years = 5
				}
			}
		}
	}
}

# The meeting with the fellow vassal goes nowhere
character_event = {
	id = PlusFaction.132
	desc = EVTDESC_PlusFaction_132
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = CURSES

		prestige = -25
	}
}

# The meeting with the fellow vassal goes poorly
character_event = {
	id = PlusFaction.133
	desc = EVTDESC_PlusFaction_133
	picture = GFX_evt_shadowy_cabal

	is_triggered_only = yes
	show_from_from = yes

	option = {
		name = CURSES

		prestige = -50

		random_list = {
			60 = {
				reverse_opinion = {
					name = unpleasant_meeting
					who = FROMFROM
					years = 5
				}
			}

			40 = {
				reverse_opinion = {
					name = unpleasant_meeting
					who = FROMFROM
					years = 5
					multiplier = 2
				}
			}
		}
	}
}

### UNDERMINING A FACTION MEMBER

# Spymaster reports a chance to undermine a faction member
letter_event = {
	id = PlusFaction.135
	border = GFX_event_letter_frame_intrigue

	desc = {
		text = EVTDESC_PlusFaction_135_COURT
		trigger = {
			event_target:faction_member = { in_faction = faction_court }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_135_PROSPERITY
		trigger = {
			event_target:faction_member = { in_faction = faction_prosperity }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_135_GLORY
		trigger = {
			event_target:faction_member = { in_faction = faction_glory }
		}
	}
	desc = {
		text = EVTDESC_PlusFaction_135_TRADITION
		trigger = {
			event_target:faction_member = { in_faction = faction_tradition }
		}
	}

	is_triggered_only = yes

	min_age = 16
	only_capable = yes
	prisoner = no

	option = {
		name = EVTOPTA_PlusFaction_135 # Do it secretly

		ai_chance = {
			factor = 50

			trigger = {
				opinion = {
					who = event_target:faction_member
					value < 50
				}
			}

			mult_modifier = {
				factor = 1.5
				event_target:faction_member = { trait = brave }
			}

			mult_modifier = {
				factor = 1.5
				event_target:faction_member = { trait = wroth }
			}

			mult_modifier = {
				factor = 1.5
				event_target:faction_member = { trait = proud }
			}

			mult_modifier = {
				factor = 1.5
				trait = deceitful
			}
		}

		random_list = {
			50 = { # Attempt succeeds
				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 2
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 4
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 6
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 8
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 2
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 4
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 6
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 8
						}
					}
				}

				character_event = {
					id = PlusFaction.141
					tooltip = FACTION_UNDERMINE_SUCCEEDS
				}
			}

			50 = { # Attempt fails
				mult_modifier = {
					factor = 0.5
					event_target:faction_member = { leads_faction = no }
				}

				character_event = {
					id = PlusFaction.139
					tooltip = FACTION_UNDERMINE_FAILS
				}
			}

			25 = { # Attempt fails and is revealed
				trigger = {
					event_target:faction_member = {
						job_spymaster = { character = yes }
					}
				}

				mult_modifier = {
					factor = 1.25

					event_target:faction_member = {
						job_spymaster = { intrigue >= 14 }
					}
				}

				mult_modifier = {
					factor = 1.25

					event_target:faction_member = {
						job_spymaster = { intrigue >= 17 }
					}
				}

				mult_modifier = {
					factor = 1.5

					event_target:faction_member = {
						job_spymaster = { intrigue >= 20 }
					}
				}

				mult_modifier = {
					factor = 0.75

					event_target:faction_member = {
						job_spymaster = { intrigue < 10 }
					}
				}

				mult_modifier = {
					factor = 0.75

					event_target:faction_member = {
						job_spymaster = { intrigue < 7 }
					}
				}

				mult_modifier = {
					factor = 0.5

					event_target:faction_member = {
						job_spymaster = { intrigue < 4 }
					}
				}

				character_event = {
					id = PlusFaction.140
					tooltip = FACTION_UNDERMINE_DISCOVERED
				}
			}
		}
	}

	option = {
		name = EVTOPTB_PlusFaction_135 # Threaten him

		event_target:faction_member = {
			show_scope_change = no

			letter_event = {
				id = PlusFaction.136
				days = 7
				tooltip = FACTION_UNDERMINE_THREATEN
			}
		}

		ai_chance = {
			factor = 50

			trigger = {
				opinion = {
					who = event_target:faction_member
					value < 50
				}
			}

			mult_modifier = {
				factor = 1.5
				event_target:faction_member = { trait = craven }
			}

			mult_modifier = {
				factor = 1.5
				event_target:faction_member = { trait = paranoid }
			}

			mult_modifier = {
				factor = 1.5
				event_target:faction_member = { trait = slothful }
			}

			mult_modifier = {
				factor = 1.5
				trait = brave
			}

			mult_modifier = {
				factor = 0.5
				trait = deceitful
			}

			mult_modifier = {
				factor = 0.5
				trait = craven
			}
		}
	}

	option = {
		name = EVTOPTC_PlusFaction_135 # Leave him alone

		ai_chance = {
			factor = 50

			mult_modifier = {
				factor = 3

				opinion = {
					who = event_target:faction_member
					value >= 0
				}
			}

			mult_modifier = {
				factor = 3

				opinion = {
					who = event_target:faction_member
					value >= 25
				}
			}

			mult_modifier = {
				factor = 0.75
				job_spymaster = { intrigue >= 14 }
			}

			mult_modifier = {
				factor = 0.75
				job_spymaster = { intrigue >= 16 }
			}

			mult_modifier = {
				factor = 0.5
				job_spymaster = { intrigue >= 18 }
			}

			mult_modifier = {
				factor = 1.5
				job_spymaster = { intrigue < 10 }
			}

			mult_modifier = {
				factor = 1.5
				job_spymaster = { intrigue < 7 }
			}

			mult_modifier = {
				factor = 2
				job_spymaster = { intrigue < 4 }
			}

			mult_modifier = {
				factor = 2
				trait = just
			}

			mult_modifier = {
				factor = 5
				trait = kind
			}

			mult_modifier = {
				factor = 5
				trait = honest
			}
		}
	}
}

# Target is openly threatened
letter_event = {
	id = PlusFaction.136
	desc = EVTDESC_PlusFaction_136
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	trigger = {
		vassal_of = FROM
		pf_member_trigger = yes
	}

	option = {
		name = EVTOPTA_PlusFaction_136 # Submit

		FROM = {
			show_scope_change = no

			letter_event = {
				id = PlusFaction.137
				tooltip = LEAVE_ALL_FACTIONS_10_YEARS
			}
		}

		opinion = {
			name = opinion_coerced_into_leaving_faction
			who = FROM
			years = 10
		}

		ai_chance = {
			factor = 30

			mult_modifier = {
				factor = 1.5
				leads_faction = no
			}

			mult_modifier = {
				factor = 0.5
				trait = brave
			}

			mult_modifier = {
				factor = 0.75
				trait = proud
			}

			mult_modifier = {
				factor = 0.75
				trait = wroth
			}

			mult_modifier = {
				factor = 2
				trait = craven
			}

			mult_modifier = {
				factor = 1.5
				trait = slothful
			}

			mult_modifier = {
				factor = 1.5
				trait = paranoid
			}
		}
	}

	option = {
		name = EVTOPTB_PlusFaction_136 # Tell him to do his worst

		opinion = {
			name = opinion_furious
			who = FROM
			years = 10
		}

		FROM = {
			show_scope_change = no

			letter_event = {
				id = PlusFaction.138
				tooltip = TELL_HIM_DO_HIS_WORST
			}
		}

		ai_chance = { factor = 70 }
	}
}

# Liege informed that target submitted
letter_event = {
	id = PlusFaction.137
	desc = EVTDESC_PlusFaction_137
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	ai = no

	option = {
		name = EXCELLENT
	}
}

# Liege informed that target refused to submit
letter_event = {
	id = PlusFaction.138
	desc = EVTDESC_PlusFaction_138
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_138 # Press forward, then

		random_list = {
			50 = { # Attempt succeeds
				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 2
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 4
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 6
						}
					}
				}

				mult_modifier = {
					factor = 0.8

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value <= 8
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 2
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 4
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 6
						}
					}
				}

				mult_modifier = {
					factor = 1.2

					job_spymaster = {
						attribute_diff = {
							character = event_target:faction_member
							attribute = intrigue
							value >= 8
						}
					}
				}

				character_event = {
					id = PlusFaction.141
					tooltip = FACTION_UNDERMINE_SUCCEEDS
				}
			}

			100 = { # Attempt fails and is revealed
				trigger = {
					event_target:faction_member = {
						job_spymaster = { character = yes }
					}
				}

				mult_modifier = {
					factor = 1.25

					event_target:faction_member = {
						job_spymaster = { intrigue >= 14 }
					}
				}

				mult_modifier = {
					factor = 1.25

					event_target:faction_member = {
						job_spymaster = { intrigue >= 17 }
					}
				}

				mult_modifier = {
					factor = 1.5

					event_target:faction_member = {
						job_spymaster = { intrigue >= 20 }
					}
				}

				mult_modifier = {
					factor = 0.75

					event_target:faction_member = {
						job_spymaster = { intrigue < 10 }
					}
				}

				mult_modifier = {
					factor = 0.75

					event_target:faction_member = {
						job_spymaster = { intrigue < 7 }
					}
				}

				mult_modifier = {
					factor = 0.5

					event_target:faction_member = {
						job_spymaster = { intrigue < 4 }
					}
				}

				character_event = {
					id = PlusFaction.140
					tooltip = FACTION_UNDERMINE_DISCOVERED
				}
			}
		}

		ai_chance = { factor = 50 }
	}

	option = {
		name = EVTOPTB_PlusFaction_138 # Drop it

		ai_chance = { factor = 150 }
	}
}

# Attempt to undermine target fails
character_event = {
	id = PlusFaction.139
	desc = EVTDESC_PlusFaction_139
	picture = GFX_evt_courtiers_talking
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = CURSES

		prestige = -25
	}
}

# Attempt to undermine target revealed
character_event = {
	id = PlusFaction.140
	desc = EVTDESC_PlusFaction_140
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = CURSES

		prestige = -50

		hidden_effect = {
			any_vassal = {
				limit = {
					trigger_if = {
						limit = { in_faction = faction_court }
						event_target:faction_member = { in_faction = faction_court }
					}
					trigger_else_if = {
						limit = { in_faction = faction_prosperity }
						event_target:faction_member = { in_faction = faction_prosperity }
					}
					trigger_else_if = {
						limit = { in_faction = faction_glory }
						event_target:faction_member = { in_faction = faction_glory }
					}
					trigger_else = {
						in_faction = faction_tradition
						event_target:faction_member = { in_faction = faction_tradition }
					}
				}

				character_event = { id = PlusFaction.142 }
			}
		}
	}
}

# Attempt to undermine target succeeded
character_event = {
	id = PlusFaction.141
	desc = EVTDESC_PlusFaction_141
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EXCELLENT

		prestige = 50

		hidden_effect = {
			any_vassal = {
				limit = {
					NOT = { character = event_target:faction_member }

					trigger_if = {
						limit = { in_faction = faction_court }
						event_target:faction_member = { in_faction = faction_court }
					}
					trigger_else_if = {
						limit = { in_faction = faction_prosperity }
						event_target:faction_member = { in_faction = faction_prosperity }
					}
					trigger_else_if = {
						limit = { in_faction = faction_glory }
						event_target:faction_member = { in_faction = faction_glory }
					}
					trigger_else = {
						in_faction = faction_tradition
						event_target:faction_member = { in_faction = faction_tradition }
					}
				}

				character_event = { id = PlusFaction.143 }
			}
		}
	}
}

# Faction members learn about liege's attempt to undermine
character_event = {
	id = PlusFaction.142
	desc = EVTDESC_PlusFaction_142
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_142

		if = {
			limit = {
				NOT = {
					has_opinion_modifier = {
						name = opinion_furious
						who = FROM
					}
				}
			}

			opinion = {
				name = opinion_furious
				who = FROM
				years = 5
			}
		}
	}
}

# Faction members informed of target's scandal
character_event = {
	id = PlusFaction.143
	desc = EVTDESC_PlusFaction_143
	picture = GFX_evt_scandal
	border = GFX_event_normal_frame_intrigue

	is_triggered_only = yes
	hide_from = yes

	option = {
		name = EVTOPTA_PlusFaction_143

		opinion = {
			name = opinion_furious
			who = event_target:faction_member
			years = 10
		}
	}
}


### NEGOTIATING WITH FACTION

# Chancellor reports a chance to negotiate with faction
letter_event = {
	id = PlusFaction.145
	border = GFX_event_letter_frame_diplomacy

	desc = {
		text = EVTDESC_PlusFaction_145_COURT
		trigger = { event_target:faction_leader = { leads_faction = faction_court } }
	}
	desc = {
		text = EVTDESC_PlusFaction_145_PROSPERITY
		trigger = { event_target:faction_leader = { leads_faction = faction_prosperity } }
	}
	desc = {
		text = EVTDESC_PlusFaction_145_GLORY
		trigger = { event_target:faction_leader = { leads_faction = faction_glory } }
	}
	desc = {
		text = EVTDESC_PlusFaction_145_TRADITION
		trigger = { event_target:faction_leader = { leads_faction = faction_tradition } }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_PlusFaction_145 # Make the attempt

		random_list = {
			75 = {
				mult_modifier = {
					factor = 1.05

					reverse_opinion = {
						who = event_target:faction_leader
						value >= 20
					}
				}

				mult_modifier = {
					factor = 1.05

					reverse_opinion = {
						who = event_target:faction_leader
						value >= 40
					}
				}

				mult_modifier = {
					factor = 1.05

					reverse_opinion = {
						who = event_target:faction_leader
						value >= 60
					}
				}

				mult_modifier = {
					factor = 1.05

					reverse_opinion = {
						who = event_target:faction_leader
						value >= 80
					}
				}

				mult_modifier = {
					factor = 1.05

					reverse_opinion = {
						who = event_target:faction_leader
						value >= 100
					}
				}

				mult_modifier = {
					factor = 0.9
					job_chancellor = { diplomacy < 10 }
				}

				mult_modifier = {
					factor = 0.9
					job_chancellor = { diplomacy < 8 }
				}

				mult_modifier = {
					factor = 0.9
					job_chancellor = { diplomacy < 6 }
				}

				mult_modifier = {
					factor = 0.9
					job_chancellor = { diplomacy < 4 }
				}

				mult_modifier = {
					factor = 0.9
					job_chancellor = { diplomacy < 2 }
				}

				mult_modifier = {
					factor = 1.1
					job_chancellor = { diplomacy >= 14 }
				}

				mult_modifier = {
					factor = 1.1
					job_chancellor = { diplomacy >= 16 }
				}

				mult_modifier = {
					factor = 1.1
					job_chancellor = { diplomacy >= 18 }
				}

				mult_modifier = {
					factor = 1.1
					job_chancellor = { diplomacy >= 20 }
				}


				letter_event = {
					id = PlusFaction.146
					days = 14
					tooltip = NEGOTIATE_FACTION_SUCCEED
				}
			}

			50 = {
				mult_modifier = {
					factor = 1.1

					reverse_opinion = {
						who = event_target:faction_leader
						value < -20
					}
				}

				mult_modifier = {
					factor = 1.1

					reverse_opinion = {
						who = event_target:faction_leader
						value < -40
					}
				}

				mult_modifier = {
					factor = 1.1

					reverse_opinion = {
						who = event_target:faction_leader
						value < -60
					}
				}

				mult_modifier = {
					factor = 1.1

					reverse_opinion = {
						who = event_target:faction_leader
						value < -80
					}
				}

				letter_event = {
					id = PlusFaction.147
					days = 14
					tooltip = NEGOTIATE_FACTION_FAIL
				}
			}

			25 = {
				mult_modifier = {
					factor = 2

					trigger_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_court } }
						has_character_flag = faction_court_angry
					}
					trigger_else_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_prosperity } }
						has_character_flag = faction_prosperity_angry
					}
					trigger_else_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_glory } }
						has_character_flag = faction_glory_angry
					}
					trigger_else = {
						event_target:faction_leader = { leads_faction = faction_tradition }
						has_character_flag = faction_tradition_angry
					}
				}

				mult_modifier = {
					factor = 0.25

					trigger_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_court } }
						has_character_flag = faction_court_happy
					}
					trigger_else_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_prosperity } }
						has_character_flag = faction_prosperity_happy
					}
					trigger_else_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_glory } }
						has_character_flag = faction_glory_happy
					}
					trigger_else = {
						event_target:faction_leader = { leads_faction = faction_tradition }
						has_character_flag = faction_tradition_happy
					}
				}

				mult_modifier = {
					factor = 0.5

					trigger_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_court } }

						NOR = {
							has_character_flag = faction_court_happy
							has_character_flag = faction_court_unhappy
							has_character_flag = faction_court_angry
						}
					}
					trigger_else_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_prosperity } }

						NOR = {
							has_character_flag = faction_prosperity_happy
							has_character_flag = faction_prosperity_unhappy
							has_character_flag = faction_prosperity_angry
						}
					}
					trigger_else_if = {
						limit = { event_target:faction_leader = { leads_faction = faction_glory } }

						NOR = {
							has_character_flag = faction_glory_happy
							has_character_flag = faction_glory_unhappy
							has_character_flag = faction_glory_angry
						}
					}
					trigger_else = {
						event_target:faction_leader = { leads_faction = faction_tradition }

						NOR = {
							has_character_flag = faction_tradition_happy
							has_character_flag = faction_tradition_unhappy
							has_character_flag = faction_tradition_angry
						}
					}
				}

				letter_event = {
					id = PlusFaction.148
					days = 14
					tooltip = NEGOTIATE_FACTION_WORSE
				}
			}
		}
	}

	option = {
		name = EVTOPTB_PlusFaction_145 # Leave it alone

		trigger = { ai = no }
	}
}

# Chancellor reports that the negotiations were successful
letter_event = {
	id = PlusFaction.146
	desc = EVTDESC_PlusFaction_146
	border = GFX_event_letter_frame_diplomacy

	is_triggered_only = yes
	show_from_from = yes

	trigger = {
		event_target:faction_leader = {
			vassal_of = ROOT
			pf_leader_trigger = yes
		}
	}

	option = {
		name = EXCELLENT

		prestige = 50

		if = {
			limit = { event_target:faction_leader = { leads_faction = faction_court } }

			custom_tooltip = {
				text = COURTFACTIONMOODPLUS

				any_player = {
					limit = {
						vassal_of = ROOT
						in_faction = faction_court
					}

					character_event = { id = PlusFaction.149 }
				}
			}
		}

		else_if = {
			limit = { event_target:faction_leader = { leads_faction = faction_prosperity } }

			custom_tooltip = {
				text = PROSPERITYFACTIONMOODPLUS

				any_player = {
					limit = {
						vassal_of = ROOT
						in_faction = faction_prosperity
					}

					character_event = { id = PlusFaction.149 }
				}
			}
		}

		else_if = {
			limit = { event_target:faction_leader = { leads_faction = faction_glory } }

			custom_tooltip = {
				text = GLORYFACTIONMOODPLUS

				any_player = {
					limit = {
						vassal_of = ROOT
						in_faction = faction_glory
					}

					character_event = { id = PlusFaction.149 }
				}
			}
		}

		else_if = {
			limit = { event_target:faction_leader = { leads_faction = faction_tradition } }

			custom_tooltip = {
				text = TRADITIONFACTIONMOODPLUS

				any_player = {
					limit = {
						vassal_of = ROOT
						in_faction = faction_tradition
					}

					character_event = { id = PlusFaction.149 }
				}
			}
		}

		hidden_effect = {
			event_target:faction_leader = {
				set_variable = {
					which = local_faction_mood_increase
					value = 2
				}
			}

			character_event = {
				id = PlusFaction.200 # Recalculate faction moods
				days = 1
			}
		}
	}
}

# Chancellor reports that the negotiations failed
letter_event = {
	id = PlusFaction.147
	desc = EVTDESC_PlusFaction_147
	border = GFX_event_letter_frame_diplomacy

	is_triggered_only = yes
	show_from_from = yes

	trigger = {
		event_target:faction_leader = {
			vassal_of = ROOT
			pf_leader_trigger = yes
		}
	}

	option = {
		name = OK

		prestige = -25

		hidden_effect = {
			any_player = {
				limit = {
					vassal_of = ROOT

					trigger_if = {
						limit = { in_faction = faction_court }
						event_target:faction_leaer = { leads_faction = faction_court }
					}
					trigger_else_if = {
						limit = { in_faction = faction_prosperity }
						event_target:faction_leader = { leads_faction = faction_prosperity }
					}
					trigger_else_if = {
						limit = { in_faction = faction_glory }
						event_target:faction_leader = { leads_faction = faction_glory }
					}
					trigger_else = {
						in_faction = faction_tradition
						event_target:faction_leader = { leads_faction = faction_tradition }
					}
				}

				character_event = { id = PlusFaction.150 }
			}
		}
	}
}

# Chancellor reports that the negotiations made relations with the faction worse
letter_event = {
	id = PlusFaction.148
	desc = EVTDESC_PlusFaction_148
	border = GFX_event_letter_frame_diplomacy

	is_triggered_only = yes
	show_from_from = yes

	trigger = {
		event_target:faction_leader = {
			vassal_of = ROOT
			pf_leader_trigger = yes
		}
	}

	option = {
		name = CURSES

		prestige = -50

		event_target:faction_leader = {
			show_scope_change = no

			trigger_switch = {
				on_trigger = leads_faction

				faction_court = { custom_tooltip = { text = COURTFACTIONMOODMINUS } }
				faction_prosperity = { custom_tooltip = { text = PROSPERITYFACTIONMOODMINUS } }
				faction_glory = { custom_tooltip = { text = GLORYFACTIONMOODMINUS } }
				faction_tradition = { custom_tooltip = { text = TRADITIONFACTIONMOODMINUS } }
			}

			hidden_effect = {
				set_variable = {
					which = local_faction_mood_decrease
					value = 2
				}

				any_player = {
					limit = {
						vassal_of = ROOT

						trigger_if = {
							limit = { in_faction = faction_court }
							event_target:faction_leaer = { leads_faction = faction_court }
						}
						trigger_else_if = {
							limit = { in_faction = faction_prosperity }
							event_target:faction_leader = { leads_faction = faction_prosperity }
						}
						trigger_else_if = {
							limit = { in_faction = faction_glory }
							event_target:faction_leader = { leads_faction = faction_glory }
						}
						trigger_else = {
							in_faction = faction_tradition
							event_target:faction_leader = { leads_faction = faction_tradition }
						}
					}

					character_event = { id = PlusFaction.151 }
				}
			}
		}

		character_event = {
			id = PlusFaction.200 # Recalculate faction moods
			days = 1
		}
	}
}

# Inform faction members of successful negotiation
character_event = {
	id = PlusFaction.149
	picture = GFX_evt_council
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_PlusFaction_149_COURT
		trigger = { event_target:faction_leader = { leads_faction = faction_court } }
	}
	desc = {
		text = EVTDESC_PlusFaction_149_PROSPERITY
		trigger = { event_target:faction_leader = { leads_faction = faction_prosperity } }
	}
	desc = {
		text = EVTDESC_PlusFaction_149_GLORY
		trigger = { event_target:faction_leader = { leads_faction = faction_glory } }
	}
	desc = {
		text = EVTDESC_PlusFaction_149_TRADITION
		trigger = { event_target:faction_leader = { leads_faction = faction_tradition } }
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = OK
	}
}

# Inform faction members of failed negotiation
character_event = {
	id = PlusFaction.150
	picture = GFX_evt_council
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_PlusFaction_150_COURT
		trigger = { event_target:faction_leader = { leads_faction = faction_court } }
	}
	desc = {
		text = EVTDESC_PlusFaction_150_PROSPERITY
		trigger = { event_target:faction_leader = { leads_faction = faction_prosperity } }
	}
	desc = {
		text = EVTDESC_PlusFaction_150_GLORY
		trigger = { event_target:faction_leader = { leads_faction = faction_glory } }
	}
	desc = {
		text = EVTDESC_PlusFaction_150_TRADITION
		trigger = { event_target:faction_leader = { leads_faction = faction_tradition } }
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = OK
	}
}

# Inform faction members of successful negotiation
character_event = {
	id = PlusFaction.151
	picture = GFX_evt_council
	border = GFX_event_normal_frame_diplomacy

	desc = {
		text = EVTDESC_PlusFaction_151_COURT
		trigger = { event_target:faction_leader = { leads_faction = faction_court } }
	}
	desc = {
		text = EVTDESC_PlusFaction_151_PROSPERITY
		trigger = { event_target:faction_leader = { leads_faction = faction_prosperity } }
	}
	desc = {
		text = EVTDESC_PlusFaction_151_GLORY
		trigger = { event_target:faction_leader = { leads_faction = faction_glory } }
	}
	desc = {
		text = EVTDESC_PlusFaction_151_TRADITION
		trigger = { event_target:faction_leader = { leads_faction = faction_tradition } }
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = OK
	}
}


### VETTING A PRETENDER

# Pretender faction leader approaches pretender for confirmation
letter_event = {
	id = PlusFaction.155
	desc = EVTDESC_PlusFaction_155
	border = GFX_event_letter_frame_intrigue

	is_triggered_only = yes
	show_from_from = yes

	immediate = {
		FROMFROM = {
			supported_claimant_title = {
				save_event_target_as = faction_title
				holder_scope = { save_event_target_as = faction_title_holder }
			}
		}
	}

	option = {
		name = EVTOPTA_PlusFaction_155 # I agree

		custom_tooltip = { text = PRETENDER_FACTION_CONTINUES }
	}

	option = {
		name = EVTOPTB_PlusFaction_155 # I refuse

		custom_tooltip = {
			text = PRETENDER_FACTION_DISSOLVES

			clr_character_flag = supported_pretender_faction
			set_character_flag = refused_pretender_faction
		}

		reverse_opinion = {
			name = opinion_very_disappointed
			who = FROMFROM
			years = 5
		}
	}
}