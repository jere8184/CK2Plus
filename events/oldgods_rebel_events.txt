#########################################################
#
# Rebel Events for The Old Gods DLC
# ( TOG.1000 to TOG.1199)
#
# NOTE: The Old Gods DLC disables the old rebel system
#
#########################################################

# Written by Henrik FÃ¥hraeus

namespace = TOG

# Single event to decide which uprising occurs
# Avoids all manner of messy, ugly triggers
province_event = {
	id = TOG.999

	is_triggered_only = yes # on_rebel_revolt
	hide_window = yes

	trigger = {
		total_years_played >= 2

		# Not if there is already an ongoing revolt
		top_liege = {
			NAND = {
				has_character_flag = has_current_revolt
				war = yes
			}
		}
	}

	immediate = {
		# See if a minor clan could rise up
		if = {
			limit = {
				has_dlc = "Horse Lords"
				culture = owner
				has_empty_holding = yes # To allow a Clan capital

				owner = {
					independent = yes
					is_nomadic = yes
					risks_minor_clan_rising = yes
					in_revolt = no
					NOT = { is_capital = ROOT }
				}
			}

			if = {
				limit = {
					top_liege = {
						any_war = {
							defender = { character = PREVPREV }
							using_cb = cb_minor_clan_revolt
						}
					}
				}

				province_event = { id = HL.2010 } # Reinforce ongoing minor clan uprising
			}
			else = {
				province_event = { id = HL.2000 } # Start new minor clan uprising
			}
		}
		else_if = {
			limit = {
				OR = {
					has_castle = yes
					has_tribal = yes
					has_temple = yes
					has_city = yes
				}

				has_dlc = "The Old Gods"
			}

			# Heretic revolts have the highest priority
			if = {
				limit = {
					is_heresy_of = top_liege

					NOT = { # Not if there is already an ongoing revolt
						top_liege = {
							any_war = {
								defender = { character = PREVPREV }

								OR = {
									AND = {
										using_cb = peasant_revolt
										war_title = ROOT # The county
									}

									AND = {
										using_cb = religious_revolt
										attacker = { religion = ROOT }
									}
								}
							}
						}
					}
				}

				if = {
					limit = {
						top_liege = {
							any_war = {
								defender = { character = PREVPREV }
								using_cb = heretic_revolt
								attacker = { religion = ROOT }
							}
						}
					}

					province_event = { id = TOG.1030 } # Reinforce ongoing heretic revolt
				}
				else = {
					province_event = { id = TOG.1020 } # Start new heretic revolt
				}
			}
			# Nationalist revolts have the next highest priority
			else_if = {
				limit = {
					top_liege = {
						compare_cultures_ROOT_trigger = no

						NOR = {
							any_demesne_title = { temporary = yes }

							AND = {
								is_theocracy = yes
								religion = ROOT

								OR = {
									controls_religion = yes
									has_landed_title = b_roma
									has_landed_title = b_hagiasophia
								}
							}
						}
					}

					kingdom = {
						culture = ROOT

						# The de jure kingdom must have had an appropriate holder in the past
						trigger_if = {
							limit = { holder_scope = { culture = ROOT } }

							holder_scope = {
								top_liege = {
									ROOT = {
										owner = {
											OR = {
												character = PREVPREV
												is_vassal_or_below_of = PREVPREV
											}
										}
									}
								}
							}
						}
					}

					NOT = { # Not if there is already an ongoing revolt
						top_liege = {
							any_war = {
								defender = { character = PREVPREV }

								trigger_if = {
									limit = { using_cb = heretic_revolt }
									attacker = { religion = ROOT }
								}
								trigger_else = {
									using_cb = liberation_revolt
									ROOT = { de_jure_liege_or_above = thirdparty_title_scope }
								}
							}
						}
					}
				}

				if = {
					limit = {
						# There is already an ongoing nationalist revolt for the same kingdom
						top_liege = {
							any_war = {
								using_cb = liberation_revolt
								defender = { character = PREVPREV }
								ROOT = { de_jure_liege_or_above = thirdparty_title_scope }
							}
						}
					}

					province_event = { id = TOG.1050 } # Reinforce ongoing revolt
				}
				else = {
					province_event = { id = TOG.1040 } # Start new revolt
				}
			}
			# Religious revolts are lower priority still
			else_if = {
				limit = {
					top_liege = {
						trigger_if = {
							limit = { religion_group = ROOT }

							OR = {
								religion = bon_pagan
								religion = buddhist
							}

							ROOT = { has_province_modifier = recent_bon_conversion }
						}
					}

					NOT = { # Not if there is already an ongoing revolt
						top_liege = {
							any_war = {
								defender = { character = PREVPREV }
								using_cb = peasant_revolt
								war_title = ROOT # The province
							}
						}
					}
				}

				if = {
					limit = {
						top_liege = {
							any_war = {
								using_cb = religious_revolt
								defender = { character = PREVPREV }
								attacker = { religion = ROOT }
							}
						}
					}

					province_event = { id = TOG.1070 } # Reinforce ongoing religious revolt
				}
				else = {
					province_event = { id = TOG.1060 } # Start new religious revolt
				}
			}
			# Plus addition: Decadence revolt
			else_if = {
				limit = {
					has_province_modifier = decadence_unrest

					top_liege = {
						religion_group = muslim
						trait = dynasty_decadence_high
					}
				}

				if = {
					limit = {
						top_liege = {
							war = yes
							religion_group = muslim

							any_war = {
								using_cb = decadence_revolt
								defender = { character = PREVPREV }

								attacker = {
									religion_group = muslim
									religion_group = ROOT
								}
							}
						}
					}

					province_event = { id = TOG.1090 } # Reinforce ongoing revolt
				}
				else = {
					province_event = { id = TOG.1080 } # Start new decadence revolt
				}
			}
			# Peasant revolts are the fallback
			else = {
				if = {
					limit = {
						top_liege = {
							any_war = {
								defender = { character = PREVPREV }
								using_cb = peasant_revolt
								war_title = ROOT # The province
							}
						}
					}

					province_event = { id = TOG.1010 } # Reinforce ongoing peasant uprising
				}
				else = {
					province_event = { id = TOG.1000 } # Start new peasant uprising
				}
			}
		}
	}
}

# Peasant Rebels rise up (temporary rebel title created, with a leader and a war)
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1000
	desc = EVTDESC_TOG_1000
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999; MNM.20017, mnm_devil_worshipers_events.txt

	immediate = {
		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		remove_province_modifier = rumors_of_witchcraft

		top_liege = {
			save_event_target_as = province_top_liege
		}

		create_character = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 25
			add_trait = tough_soldier
			add_trait = peasant_leader

			attributes = {
				martial = 5
			}
		}

		new_character = {
			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				rebel = yes
				culture = ROOT
				name = PEASANT_REVOLT
				holder = THIS
			}

			wealth = 100
			spawn_peasant_army_effect = yes

			if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = powerful
					}
				}

				spawn_peasant_army_effect = yes
				wealth = 150
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = very_powerful
					}
				}
				spawn_peasant_army_effect = yes
				spawn_peasant_army_effect = yes
				wealth = 250
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = extremely_powerful
					}
				}
				spawn_peasant_army_effect = yes
				spawn_peasant_army_effect = yes
				spawn_peasant_army_effect = yes
				wealth = 350
			}

			# DoW on the province top liege
			war = {
				target = event_target:province_top_liege
				casus_belli = peasant_revolt
				thirdparty_title = ROOT
			}

			opinion = {
				name = opinion_evil_tyrant
				who = event_target:province_top_liege
			}
		}

		owner = {
			any_liege = { # Inform the lieges
				character_event = { id = TOG.1001 }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1000
	}
}

character_event = {
	id = TOG.1001
	desc = EVTDESC_TOG_1001
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1000
	}
}

# Peasants seize a holding. Fired from 'on_siege_over_winner'.
character_event = {
	id = TOG.1005

	is_triggered_only = yes # on_siege_over_winner
	hide_window = yes

	trigger = {
		trait = peasant_leader
		rebel = yes

		FROM = {
			is_capital = yes # The capital holding
		}
	}

	immediate = {
		FROM = {
			location = {
				if = {
					limit = {
						NOT = { has_province_modifier = peasant_unrest }
					}

					add_province_modifier = {
						name = peasant_unrest
						years = 2
					}
				}
			}
		}
	}
}

# Peasant Rebels rise up to reinforce an ongoing provincial peasant revolt
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1010
	desc = EVTDESC_TOG_1010
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		if = {
			limit = { has_province_modifier = peasant_unrest }
			remove_province_modifier = peasant_unrest
		}

		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		owner = {
			top_liege = {
				any_war = {
					limit = {
						defender = { character = PREVPREV }
						using_cb = peasant_revolt
						war_title = ROOT # The province
					}

					attacker = {
						spawn_peasant_reinforcements_effect = yes

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = powerful
								}
							}

							spawn_peasant_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = very_powerful
								}
							}
							spawn_peasant_reinforcements_effect = yes
							spawn_peasant_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = extremely_powerful
								}
							}
							spawn_peasant_reinforcements_effect = yes
							spawn_peasant_reinforcements_effect = yes
							spawn_peasant_reinforcements_effect = yes
						}
					}
				}
			}

			any_liege = { # Inform the lieges
				character_event = { id = TOG.1011 }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1010
	}
}

character_event = {
	id = TOG.1011
	desc = EVTDESC_TOG_1011
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1010
	}
}

# Heretic Rebels rise up (temporary rebel title created, with a leader and a war)
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1020
	desc = EVTDESC_TOG_1020
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		top_liege = {
			save_event_target_as = province_top_liege
		}

		duchy = {
			save_event_target_as = province_duchy
		}

		create_character = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 32
			add_trait = heresiarch
			add_trait = zealous
			add_trait = scholar
			add_trait = skilled_tactician

			attributes = {
				martial = 7
				learning = 7
			}
		}

		new_character = {
			set_character_flag = heretic_revolter

			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				rebel = yes
				culture = ROOT
				name = HERETIC_REVOLT
				holder = THIS
				ruler = HERESIARCH
			}

			wealth = 100

			spawn_heretic_army_effect = yes

			if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = powerful
					}
				}

				spawn_heretic_army_effect = yes
				wealth = 150
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = very_powerful
					}
				}
				spawn_heretic_army_effect = yes
				spawn_heretic_army_effect = yes
				wealth = 250
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = extremely_powerful
					}
				}
				spawn_heretic_army_effect = yes
				spawn_heretic_army_effect = yes
				spawn_heretic_army_effect = yes
				wealth = 350
			}

			# DoW on the province top liege
			war = {
				target = event_target:province_top_liege
				casus_belli = heretic_revolt
				thirdparty_title = event_target:province_duchy
			}

			opinion = {
				name = opinion_evil_tyrant
				who = event_target:province_top_liege
			}
		}

		owner = {
			any_liege = { # Inform the lieges
				character_event = { id = TOG.1021 }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1020
	}
}

character_event = {
	id = TOG.1021
	desc = EVTDESC_TOG_1021
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1020
	}
}

# Heretics seize a holding. Fired from 'on_siege_over_winner'.
character_event = {
	id = TOG.1025

	is_triggered_only = yes # on_siege_over_winner
	hide_window = yes

	trigger = {
		trait = heresiarch
		rebel = yes

		FROM = {
			is_capital = yes # The capital holding
		}
	}

	immediate = {
		FROM = {
			location = {
				if = {
					limit = {
						NOT = { religion = ROOT }
					}

					random = {
						chance = 50
						religion = ROOT
					}
				}

				if = {
					limit = {
						NOT = { has_province_modifier = religious_unrest }
					}

					add_province_modifier = {
						name = religious_unrest
						years = 2
					}
				}
			}
		}
	}
}

# Heretic Rebels rise up to reinforce an ongoing heretic uprising
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1030
	desc = EVTDESC_TOG_1030
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		if = {
			limit = { has_province_modifier = religious_unrest }
			remove_province_modifier = religious_unrest
		}

		owner = {
			top_liege = {
				any_war = {
					limit = {
						using_cb = heretic_revolt
						defender = { character = PREVPREV }
						attacker = { religion = ROOT }
					}

					attacker = {
						spawn_heretic_reinforcements_effect = yes

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = powerful
								}
							}

							spawn_heretic_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = very_powerful
								}
							}
							spawn_heretic_reinforcements_effect = yes
							spawn_heretic_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = extremely_powerful
								}
							}
							spawn_heretic_reinforcements_effect = yes
							spawn_heretic_reinforcements_effect = yes
							spawn_heretic_reinforcements_effect = yes
						}
					}
				}
			}

			any_liege = { # Inform the lieges
				character_event = { id = TOG.1031 }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1030
	}
}

character_event = {
	id = TOG.1031
	desc = EVTDESC_TOG_1031
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1030
	}
}

# Dealing with the province where the rebellion started
province_event = {
	id = TOG.1032

	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_province_modifier = rebellion_heretic_province
	}

	immediate = {
		remove_province_modifier = rebellion_heretic_province

		if = {
			limit = { is_heresy_of = top_liege }

			remove_province_modifier = recent_county_uprising

			top_liege = {
				character_event = { id = TOG.1033 }
			}
		}
	}
}

character_event = {
	id = TOG.1033
	desc = EVTDESC_TOG_1033
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		log = "[Root.GetTitledName] receives option to deal with [From.GetName], where Heretic rebellion began"
	}

	option = {
		name = EVTOPTA_TOG_1033 # Teach them a lesson

		tyrant_plus_1_effect = yes

		random = {
			chance = 50
			add_trait_partially_wroth_effect = yes
		}

		random = {
			chance = 25
			remove_trait_kind_effect = yes
		}

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = rebellion_lesson
				years = 5
			}

			random_list = {
				25 = { religion = ROOT }

				75 = {
					add_province_modifier = {
						name = recent_county_uprising
						years = 10
					}
				}
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_HERETIC

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					religion = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 2
				}
			}
		}

		ai_chance = {
			factor = 30

			trigger = {
				trigger_if = {
					limit = { trait = tyrant5 }

					OR = {
						trait = lunatic
						trait = possessed
					}
				}
			}

			mult_modifier = {
				factor = 0.1

				OR = {
					trait = patient
					trait = kind
				}
			}

			mult_modifier = {
				factor = 0.25

				trait = tyrant4

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}
		}
	}

	option = {
		name = EVTOPTB_TOG_1033 # Do whatever it takes

		tyrant_plus_2_effect = yes

		if = {
			limit = { trait = patient }
			remove_trait = patient
		}
		else_if = {
			limit = { NOT = { trait = wroth } }

			random = {
				chance = 50
				add_trait_wroth_effect = yes
			}
		}

		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		if = {
			limit = { NOT = { trait = cruel } }

			random = {
				chance = 50
				add_trait_cruel_effect = yes
			}
		}

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = rebellion_reprisal
				years = 5
			}

			random_list = {
				50 = { religion = ROOT }

				50 = {
					add_province_modifier = {
						name = recent_county_uprising
						years = 20
					}
				}
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_HERETIC

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					religion = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 3
				}
			}
		}

		ai_chance = {
			factor = 10

			trigger = {
				NOR = {
					trait = patient
					trait = kind
				}

				trigger_if = {
					limit = { trait = tyrant4 }

					OR = {
						trait = lunatic
						trait = possessed
					}
				}
			}

			mult_modifier = {
				factor = 2
				trait = cruel
			}
		}
	}

	option = {
		name = EVTOPTC_TOG_1033 # We will find another way

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = recent_county_uprising
				years = 5
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_HERETIC

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					religion = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 1
				}
			}
		}

		ai_chance = {
			factor = 60

			mult_modifier = {
				factor = 0.5
				trait = cruel
			}

			mult_modifier = {
				factor = 0.5
				trait = wroth
			}

			mult_modifier = {
				factor = 0.5
				trait = zealous
			}

			mult_modifier = {
				factor = 1.5

				OR = {
					trait = tyrant1
					trait = tyrant2
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 2

				OR = {
					trait = tyrant3
					trait = tyrant4
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 3

				trait = tyrant5

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}
		}
	}
}

### NATIONALIST REBELS

# Royalist Nationalist Rebels rise up to create a kingdom (temporary rebel title created, with a leader and a war)
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1040
	desc = EVTDESC_TOG_1040
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		save_event_target_as = revolt_location
		kingdom = { save_event_target_as = revolt_kingdom }
		top_liege = { save_event_target_as = revolt_top_liege }

		create_character = {
			random_traits = yes
			dynasty = random
			religion = ROOT
			culture = ROOT
			female = no
			age = 20
			health = 7
			fertility = 0.7
			add_trait = just
			add_trait = brave
			add_trait = gregarious
			add_trait = ambitious
			add_trait = brilliant_strategist
			add_trait = inspiring_leader

			attributes = {
				martial = 8
				diplomacy = 9
			}
		}

		new_character = {
			save_event_target_as = nationalist_revolt_leader
			set_character_flag = began_revolt

			opinion = {
				name = opinion_evil_tyrant
				who = event_target:revolt_top_liege
			}

			character_event = { id = TOG.1041 }
		}

		if = {
			limit = { has_province_modifier = cultural_unrest }
			remove_province_modifier = cultural_unrest
		}

		add_province_modifier = {
			name = rebellion_nationalist_province
			years = 5
		}

		province_event = {
			id = TOG.1052 # Remove modifier if war is over
			days = 1
		}
	}

	option = {
		name = EVTOPTA_TOG_1040
	}
}

# The revolt leader will attempt to find a ruler to lead the charge, or lead it himself
character_event = {
	id = TOG.1041

	is_triggered_only = yes
	hide_window = yes

	immediate = {
		# Start with kingdom level vassal
		if = {
			limit = {
				event_target:revolt_kingdom = {
					has_holder = yes

					holder_scope = {
						culture = ROOT
						religion = ROOT
						capital_scope = { kingdom = { title = event_target:revolt_kingdom } }
						top_liege = { character = event_target:revolt_top_liege }
						is_adult = yes
						prisoner = no
						is_incapable = no
						pf_war_trait_trigger = no

						NOR = {
							any_liege = { pf_war_flag_trigger = yes }
							character = event_target:revolt_top_liege
							has_truce = event_target:revolt_top_liege
							has_non_aggression_pact_with = event_target:revolt_top_liege

							reverse_has_opinion_modifier = {
								name = refused_revolt_call
								who = ROOT
							}
						}
					}
				}
			}

			event_target:revolt_kingdom = {
				holder_scope = { character_event = { id = TOG.1042 } }
			}
		}
		# Move onto duke level vassal
		else_if = {
			limit = {
				event_target:revolt_location = {
					duchy = {
						has_holder = yes

						holder_scope = {
							culture = ROOT
							religion = ROOT
							capital_scope = { kingdom = { title = event_target:revolt_kingdom } }
							top_liege = { character = event_target:revolt_top_liege }
							is_adult = yes
							prisoner = no
							is_incapable = no
							pf_war_trait_trigger = no

							NOR = {
								any_liege = { pf_war_flag_trigger = yes }
								character = event_target:revolt_top_liege
								has_truce = event_target:revolt_top_liege
								has_non_aggression_pact_with = event_target:revolt_top_liege

								reverse_has_opinion_modifier = {
									name = refused_revolt_call
									who = ROOT
								}
							}
						}
					}
				}
			}

			event_target:revolt_location = {
				duchy = {
					holder_scope = { character_event = { id = TOG.1042 } }
				}
			}
		}
		# Move onto county owner
		else_if = {
			limit = {
				event_target:revolt_location = {
					owner = {
						culture = ROOT
						religion = ROOT
						top_liege = { character = event_target:revolt_top_liege }
						capital_scope = { kingdom = { title = event_target:revolt_kingdom } }
						is_adult = yes
						prisoner = no
						is_incapable = no
						pf_war_trait_trigger = no

						NOR = {
							any_liege = { pf_war_flag_trigger = yes }
							character = event_target:revolt_top_liege
							has_truce = event_target:revolt_top_liege
							has_non_aggression_pact_with = event_target:revolt_top_liege

							reverse_has_opinion_modifier = {
								name = refused_revolt_call
								who = ROOT
							}
						}
					}
				}
			}

			event_target:revolt_location = {
				owner = { character_event = { id = TOG.1042 } }
			}
		}
		# Move onto other dukes/counts
		else_if = {
			limit = {
				NOT = { any_liege = { pf_war_flag_trigger = yes } }

				event_target:revolt_location = {
					owner = {
						top_liege = {
							any_realm_lord = {
								OR = {
									real_tier = DUKE
									real_tier = COUNT
								}

								culture = ROOT
								religion = ROOT
								capital_scope = { kingdom = { title = event_target:revolt_kingdom } }
								is_adult = yes
								prisoner = no
								is_incapable = no
								pf_war_trait_trigger = no

								NOR = {
									any_liege = { pf_war_flag_trigger = yes }
									character = event_target:revolt_top_liege
									has_truce = event_target:revolt_top_liege
									has_non_aggression_pact_with = event_target:revolt_top_liege

									reverse_has_opinion_modifier = {
										name = refused_revolt_call
										who = ROOT
									}
								}
							}
						}
					}
				}
			}

			event_target:revolt_location = {
				owner = {
					top_liege = {
						random_realm_lord = {
							limit = {
								OR = {
									real_tier = DUKE
									real_tier = COUNT
								}

								culture = ROOT
								religion = ROOT
								capital_scope = { kingdom = { title = event_target:revolt_kingdom } }
								is_adult = yes
								prisoner = no
								is_incapable = no
								pf_war_trait_trigger = no

								NOR = {
									any_liege = { pf_war_flag_trigger = yes }
									character = event_target:revolt_top_liege
									has_truce = event_target:revolt_top_liege
									has_non_aggression_pact_with = event_target:revolt_top_liege

									reverse_has_opinion_modifier = {
										name = refused_revolt_call
										who = ROOT
									}
								}

							}

							preferred_limit = { real_tier = DUKE }

							character_event = { id = TOG.1042 }
						}
					}
				}
			}
		}
		else = {
			# Failing that, the revolt leader will do it himself
			set_character_flag = nationalist_rebel

			create_title = {
				tier = KING
				landless = yes
				temporary = yes
				culture = ROOT
				holder = ROOT
				base_title = event_target:revolt_kingdom
				copy_title_laws = yes
				name = NATIONALIST_REVOLT
				ruler = LORD
				ruler_female = LADY
			}

			event_target:revolt_location = {
				event_target:nationalist_revolt_leader = {
					spawn_nationalist_army_effect = yes

					if = {
						limit = {
							has_game_rule = {
								name = provincial_revolt_strength
								value = powerful
							}
						}
						spawn_nationalist_army_effect = yes
					}

					if = {
						limit = {
							has_game_rule = {
								name = provincial_revolt_strength
								value = very_powerful
							}
						}
						spawn_nationalist_army_effect = yes
						spawn_nationalist_army_effect = yes
					}

					if = {
						limit = {
							has_game_rule = {
								name = provincial_revolt_strength
								value = extremely_powerful
							}
						}
						spawn_nationalist_army_effect = yes
						spawn_nationalist_army_effect = yes
						spawn_nationalist_army_effect = yes
					}
				}
			}

			create_character = {
				random_traits = yes
				dynasty = none
				religion = ROOT
				culture = ROOT
				female = no
				age = 34

				attributes = {
					martial = 7
				}

				add_trait = skilled_tactician
			}

			event_target:revolt_location = {
				new_character = {
					opinion = {
						name = opinion_loyal_servant
						who = ROOT
						years = 20
					}

					spawn_nationalist_army_effect = yes

					if = {
						limit = {
							has_game_rule = {
								name = provincial_revolt_strength
								value = powerful
							}
						}
						spawn_nationalist_army_effect = yes
					}

					if = {
						limit = {
							has_game_rule = {
								name = provincial_revolt_strength
								value = very_powerful
							}
						}
						spawn_nationalist_army_effect = yes
						spawn_nationalist_army_effect = yes
					}

					if = {
						limit = {
							has_game_rule = {
								name = provincial_revolt_strength
								value = extremely_powerful
							}
						}
						spawn_nationalist_army_effect = yes
						spawn_nationalist_army_effect = yes
						spawn_nationalist_army_effect = yes
					}
				}
			}

			random = {
				chance = 50

				create_character = {
					random_traits = yes
					dynasty = none
					religion = ROOT
					culture = ROOT
					female = no
					age = 23

					attributes = {
						martial = 7
					}

					add_trait = skilled_tactician
				}

				event_target:revolt_location = {
					new_character = {
						opinion = {
							name = opinion_loyal_servant
							who = ROOT
							years = 20
						}

						spawn_nationalist_army_effect = yes

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = powerful
								}
							}
							spawn_nationalist_army_effect = yes
						}

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = very_powerful
								}
							}
							spawn_nationalist_army_effect = yes
							spawn_nationalist_army_effect = yes
						}

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = extremely_powerful
								}
							}
							spawn_nationalist_army_effect = yes
							spawn_nationalist_army_effect = yes
							spawn_nationalist_army_effect = yes
						}
					}
				}
			}

			war = {
				target = event_target:revolt_top_liege
				casus_belli = liberation_revolt
				thirdparty_title = event_target:revolt_kingdom
			}

			event_target:revolt_top_liege = {
				set_character_flag = has_current_revolt
				character_event = { id = TOG.1044 }

				any_realm_lord = {
					limit = {
						capital_scope = { kingdom = { title = event_target:revolt_kingdom } }
						religion = ROOT
						higher_real_tier_than = BARON

						OR = {
							culture = ROOT

							AND = {
								culture_group = ROOT
								PREV = { NOT = { culture_group = ROOT } }
							}
						}

						is_adult = yes
						prisoner = no
						is_incapable = no
						pf_war_trait_trigger = no

						NOR = {
							character = PREV
							has_truce = PREV
							has_non_aggression_pact_with = PREV

							reverse_has_opinion_modifier = {
								name = refused_revolt_call
								who = ROOT
							}

							any_liege = { pf_war_flag_trigger = yes }

							any_liege = {
								religion = ROOT
								capital_scope = { kingdom = { title = event_target:revolt_kingdom } }

								OR = {
									culture = ROOT

									AND = {
										culture_group = ROOT
										PREVPREV = { NOT = { culture_group = ROOT } }
									}
								}

								is_adult = yes
								prisoner = no
								is_incapable = no
								pf_war_trait_trigger = no

								NOR = {
									character = PREVPREV
									has_truce = PREVPREV
									has_non_aggression_pact_with = PREVPREV

									reverse_has_opinion_modifier = {
										name = refused_revolt_call
										who = ROOT
									}
								}
							}
						}
					}

					character_event = { id = TOG.1043 } #Ask to join the war
				}
			}
		}
	}
}

# Same-culture ruler is approached to lead the revolt
character_event = {
	id = TOG.1042
	desc = EVTDESC_TOG_1042
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_1042 # We will lead the revolt

		log = "[Root.GetBestName] has agreed to lead the liberation revolt of [From.GetBestName] against [Root.TopLiege.GetBestName]"

		save_event_target_as = leading_revolt
		set_character_flag = nationalist_rebel
		clr_character_flag = wants_to_lead_revolt
		clr_character_flag = civil_war_faction_leader
		clr_character_flag = civil_war_faction_member
		clr_character_flag = will_join_civil_war

		# Mark original liege
		opinion = {
			name = liberation_revolt_against
			who = liege
		}

		# Move the original revolter to the new leader's court
		event_target:nationalist_revolt_leader = {
			show_scope_change = no

			move_character = ROOT
			add_friend = ROOT

			hidden_effect = {
				random_list = {
					30 = {
						spawn_unit = {
							province = event_target:revolt_location
							home = event_target:revolt_location
							owner = ROOT
							scaled_by_biggest_garrison = 1.6
							attrition = 0.5
							maintenance_multiplier = 0
							earmark = nationalist_rebels_1
							cannot_inherit = yes

							troops = {
								archers = { 6 6 }
								light_cavalry = { 3 3 }
								knights = { 1 1 }
								light_infantry = { 7 7 }
								heavy_infantry = { 3 3 }
							}
						}
					}

					30 = {
						spawn_unit = {
							province = event_target:revolt_location
							home = event_target:revolt_location
							owner = ROOT
							scaled_by_biggest_garrison = 1.3
							attrition = 0.5
							maintenance_multiplier = 0
							earmark = nationalist_rebels_1
							cannot_inherit = yes

							troops = {
								archers = { 6 6 }
								light_cavalry = { 3 3 }
								knights = { 1 1 }
								light_infantry = { 7 7 }
								heavy_infantry = { 3 3 }
							}
						}
					}

					30 = {
						spawn_unit = {
							province = event_target:revolt_location
							home = event_target:revolt_location
							owner = ROOT
							scaled_by_biggest_garrison = 1
							attrition = 0.5
							maintenance_multiplier = 0
							earmark = nationalist_rebels_1
							cannot_inherit = yes

							troops = {
								archers = { 6 6 }
								light_cavalry = { 3 3 }
								knights = { 1 1 }
								light_infantry = { 7 7 }
								heavy_infantry = { 3 3 }
							}
						}
					}
				}
			}
		}

		# Create additional rebel commanders
		hidden_effect = {
			create_character = {
				random_traits = yes
				dynasty = none
				religion = ROOT
				culture = ROOT
				female = no
				age = 34

				attributes = {
					martial = 7
				}

				add_trait = skilled_tactician
			}

			new_character = {
				opinion = {
					name = opinion_loyal_servant
					who = ROOT
					years = 20
				}
			}

			random_list = {
				30 = {
					spawn_unit = {
						province = event_target:revolt_location
						home = event_target:revolt_location
						owner = ROOT
						scaled_by_biggest_garrison = 1.6
						attrition = 0.5
						maintenance_multiplier = 0
						earmark = nationalist_rebels
						disband_on_peace = yes

						troops = {
							archers = { 6 6 }
							light_cavalry = { 3 3 }
							knights = { 1 1 }
							light_infantry = { 7 7 }
							heavy_infantry = { 3 3 }
						}
					}
				}

				30 = {
					spawn_unit = {
						province = event_target:revolt_location
						home = event_target:revolt_location
						owner = ROOT
						scaled_by_biggest_garrison = 1.3
						attrition = 0.5
						maintenance_multiplier = 0
						earmark = nationalist_rebels
						disband_on_peace = yes

						troops = {
							archers = { 6 6 }
							light_cavalry = { 3 3 }
							knights = { 1 1 }
							light_infantry = { 7 7 }
							heavy_infantry = { 3 3 }
						}
					}
				}

				30 = {
					spawn_unit = {
						province = event_target:revolt_location
						home = event_target:revolt_location
						owner = ROOT
						scaled_by_biggest_garrison = 1
						attrition = 0.5
						maintenance_multiplier = 0
						earmark = nationalist_rebels
						disband_on_peace = yes

						troops = {
							archers = { 6 6 }
							light_cavalry = { 3 3 }
							knights = { 1 1 }
							light_infantry = { 7 7 }
							heavy_infantry = { 3 3 }
						}
					}
				}
			}

			random = {
				chance = 50

				create_character = {
					random_traits = yes
					dynasty = none
					religion = ROOT
					culture = ROOT
					female = no
					age = 23

					attributes = {
						martial = 7
					}

					add_trait = skilled_tactician
				}

				new_character = {
					opinion = {
						name = opinion_loyal_servant
						who = ROOT
						years = 20
					}
				}

				random_list = {
					30 = {
						spawn_unit = {
							province = event_target:revolt_location
							home = event_target:revolt_location
							owner = ROOT
							scaled_by_biggest_garrison = 1.6
							attrition = 0.5
							maintenance_multiplier = 0
							earmark = nationalist_rebels
							disband_on_peace = yes

							troops = {
								archers = { 6 6 }
								light_cavalry = { 3 3 }
								knights = { 1 1 }
								light_infantry = { 7 7 }
								heavy_infantry = { 3 3 }
							}
						}
					}

					30 = {
						spawn_unit = {
							province = event_target:revolt_location
							home = event_target:revolt_location
							owner = ROOT
							scaled_by_biggest_garrison = 1.3
							attrition = 0.5
							maintenance_multiplier = 0
							earmark = nationalist_rebels
							disband_on_peace = yes

							troops = {
								archers = { 6 6 }
								light_cavalry = { 3 3 }
								knights = { 1 1 }
								light_infantry = { 7 7 }
								heavy_infantry = { 3 3 }
							}
						}
					}

					30 = {
						spawn_unit = {
							province = event_target:revolt_location
							home = event_target:revolt_location
							owner = ROOT
							scaled_by_biggest_garrison = 1
							attrition = 0.5
							maintenance_multiplier = 0
							earmark = nationalist_rebels
							disband_on_peace = yes

							troops = {
								archers = { 6 6 }
								light_cavalry = { 3 3 }
								knights = { 1 1 }
								light_infantry = { 7 7 }
								heavy_infantry = { 3 3 }
							}
						}
					}
				}
			}

			any_liege = {
				character_event = { id = TOG.1044 } # Inform lieges
			}
		}

		# Create revolter title
		if = {
			limit = { top_liege = { real_tier = EMPEROR } }

			primary_title = {
				create_title = {
					tier = EMPEROR
					landless = yes
					temporary = yes
					culture = ROOT
					holder = ROOT
					base_title = THIS
					copy_title_laws = yes
					name = NATIONALIST_REVOLT
				}
			}
		}
		else = {
			primary_title = {
				create_title = {
					tier = KING
					landless = yes
					temporary = yes
					culture = ROOT
					holder = ROOT
					base_title = THIS
					copy_title_laws = yes
					name = NATIONALIST_REVOLT
				}
			}
		}

		# Start the actual war
		event_target:revolt_top_liege = {
			set_character_flag = has_current_revolt
		}

		war = {
			target = event_target:revolt_top_liege
			casus_belli = liberation_revolt
			thirdparty_title = event_target:revolt_kingdom
		}

		# Attempt to recruit additional revolters
		hidden_effect = {
			event_target:revolt_top_liege = {
				any_realm_lord = {
					limit = {
						higher_real_tier_than = BARON
						religion = ROOT
						capital_scope = { kingdom = { title = event_target:revolt_kingdom } }

						OR = {
							culture = ROOT

							AND = {
								culture_group = ROOT
								PREV = { NOT = { culture_group = ROOT } }
							}
						}

						is_adult = yes
						prisoner = no
						is_incapable = no
						pf_war_trait_trigger = no

						NOR = {
							has_truce = PREV
							has_non_aggression_pact_with = PREV

							reverse_has_opinion_modifier = {
								name = refused_revolt_call
								who = event_target:nationalist_revolt_leader
							}

							any_liege = { pf_war_flag_trigger = yes }

							any_liege = {
								religion = ROOT
								capital_scope = { kingdom = { title = event_target:revolt_kingdom } }

								OR = {
									culture = ROOT

									AND = {
										culture_group = ROOT
										event_target:revolt_top_liege = { NOT = { culture_group = ROOT } }
									}
								}

								is_adult = yes
								prisoner = no
								is_incapable = no
								pf_war_trait_trigger = no

								NOR = {
									character = PREVPREV
									has_truce = PREVPREV
									has_non_aggression_pact_with = PREVPREV

									reverse_has_opinion_modifier = {
										name = refused_revolt_call
										who = event_target:nationalist_revolt_leader
									}
								}
							}
						}
					}

					character_event = { id = TOG.1043 } #Ask to join the war
				}
			}
		}

		ai_chance = {
			factor = 30

			trigger = {
				opinion = {
					who = event_target:revolt_top_liege
					value < 35
				}
			}

			mult_modifier = {
				factor = 0.25
				dynasty = event_target:revolt_top_liege
			}

			mult_modifier = {
				factor = 0.25
				is_close_relative = event_target:revolt_top_liege
			}

			mult_modifier = {
				factor = 0.1

				vassal_of = event_target:revolt_top_liege

				NOR = {
					in_faction = faction_separatist
					leads_faction = faction_separatist
				}
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value < -25 }
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value < -50 }
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value < -75 }
			}

			mult_modifier = {
				factor = 1.25
				trait = brave
			}

			mult_modifier = {
				factor = 1.25
				trait = wroth
			}

			mult_modifier = {
				factor = 1.25
				trait = proud
			}

			mult_modifier = {
				factor = 2.0
				trait = ambitious
			}

			mult_modifier = {
				factor = 3.0

				OR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 1.5
				NOT = { culture_group = event_target:revolt_top_liege }
			}
		}
	}

	option = {
		name = EVTOPTB_TOG_1042 # No, this man cannot be trusted

		event_target:nationalist_revolt_leader = {
			show_scope_change = no

			opinion = {
				name = refused_revolt_call
				who = ROOT
				years = 20
			}

			character_event = { id = TOG.1041 }
		}

		ai_chance = {
			factor = 70

			trigger = {
				NOT = { has_character_flag = wants_to_lead_revolt }
			}

			mult_modifier = {
				factor = 0.1

				vassal_of = event_target:revolt_top_liege

				OR = {
					in_faction = faction_separatist
					leads_faction = faction_separatist
				}
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value >= 0 }
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value >= 25 }
			}

			mult_modifier = {
				factor = 1.5
				trait = craven
			}

			mult_modifier = {
				factor = 1.5
				trait = humble
			}

			mult_modifier = {
				factor = 2.0
				trait = content
			}
		}
	}
}

# Other same-culture rulers in the kingdom are approached to join the revolt
character_event = {
	id = TOG.1043
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	desc = {
		text = EVTDESC_TOG_1043A
		trigger = { event_target:nationalist_revolt_leader = { has_character_flag = nationalist_rebel } }
	}
	desc = {
		text = EVTDESC_TOG_1043B
		trigger = { event_target:nationalist_revolt_leader = { NOT = { has_character_flag = nationalist_rebel } } }
	}

	is_triggered_only = yes

	option = {
		name = EVTOPTA_TOG_1043 # Agree

		set_character_flag = nationalist_rebel
		clr_character_flag = wants_to_lead_revolt
		clr_character_flag = civil_war_faction_leader
		clr_character_flag = civil_war_faction_member
		clr_character_flag = will_join_civil_war

		log = "[Root.GetBestName] has agreed to join the liberation revolt of [From.GetBestName]."

		# Mark original liege
		opinion = {
			name = liberation_revolt_against
			who = liege
		}

		# Join the war

		if = {
			limit = { event_target:leading_revolt = { has_character_flag = nationalist_rebel } }

			opinion = {
				who = event_target:leading_revolt
				name = loyal_vassal
				years = 5
			}

			set_defacto_liege = event_target:leading_revolt
		}
		else_if = {
			limit = { event_target:nationalist_revolt_leader = { has_character_flag = nationalist_rebel } }

			hidden_effect = { set_defacto_liege = ROOT }
			join_attacker_wars = event_target:nationalist_revolt_leader
		}

		ai_chance = {
			factor = 50

			trigger = {
				opinion = {
					who = event_target:revolt_top_liege
					value < 35
				}
			}

			mult_modifier = {
				factor = 0.6
				FROM = { has_character_flag = began_revolt }
			}

			mult_modifier = {
				factor = 0.25
				dynasty = event_target:revolt_top_liege
			}

			mult_modifier = {
				factor = 0.25
				is_close_relative = event_target:revolt_top_liege
			}

			mult_modifier = {
				factor = 0.1

				vassal_of = event_target:revolt_top_liege

				NOR = {
					in_faction = faction_separatist
					leads_faction = faction_separatist
				}
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value < -25 }
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value < -50 }
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value < -75 }
			}

			mult_modifier = {
				factor = 1.25
				trait = brave
			}

			mult_modifier = {
				factor = 1.25
				trait = wroth
			}

			mult_modifier = {
				factor = 1.25
				trait = proud
			}

			mult_modifier = {
				factor = 2.0
				trait = ambitious
			}

			mult_modifier = {
				factor = 3.0

				OR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 1.5
				NOT = { culture_group = event_target:revolt_top_liege }
			}

			mult_modifier = {
				factor = 0.75
				NOT = { culture = event_target:nationalist_revolt_leader }
			}
		}
	}

	option = {
		name = EVTOPTB_TOG_1042 # Refuse

		if = {
			limit = { FROM = { NOT = { has_character_flag = began_revolt } } }

			reverse_opinion = {
				name = refused_revolt_call
				who = FROM
				years = 20
			}
		}

		reverse_opinion = {
			name = refused_revolt_call
			who = event_target:nationalist_revolt_leader
			years = 20
		}

		hidden_effect = {
			if = {
				limit = { FROM = { has_character_flag = nationalist_rebel } }

				any_vassal = {
					limit = {
						higher_real_tier_than = BARON
						religion = ROOT
						capital_scope = { kingdom = { title = event_target:revolt_kingdom } }

						OR = {
							culture = event_target:nationalist_revolt_leader

							AND = {
								culture_group = event_target:nationalist_revolt_leader
								event_target:revolt_top_liege = { NOT = { culture_group = event_target:nationalist_revolt_leader } }
							}
						}

						is_adult = yes
						prisoner = no
						is_incapable = no

						NOR = {
							any_liege = { pf_war_flag_trigger = yes }
							has_truce = event_target:revolt_top_liege
							has_non_aggression_pact_with = event_target:revolt_top_liege

							reverse_has_opinion_modifier = {
								name = refused_revolt_call
								who = event_target:nationalist_revolt_leader
							}
						}
					}

					character_event = { id = TOG.1043 } # Ask to join the war
				}
			}
		}

		ai_chance = {
			factor = 50

			trigger = {
				NOT = { has_character_flag = wants_to_lead_revolt }
			}

			mult_modifier = {
				factor = 1.4
				FROM = { has_character_flag = began_revolt }
			}

			mult_modifier = {
				factor = 0.1

				vassal_of = event_target:revolt_top_liege

				OR = {
					in_faction = faction_separatist
					leads_faction = faction_separatist
				}
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value >= 0 }
			}

			mult_modifier = {
				factor = 1.5
				opinion = { who = event_target:revolt_top_liege value >= 25 }
			}

			mult_modifier = {
				factor = 1.5
				trait = craven
			}

			mult_modifier = {
				factor = 1.5
				trait = humble
			}

			mult_modifier = {
				factor = 2.0
				trait = content
			}
		}
	}
}

# Inform lieges of revolt
character_event = {
	id = TOG.1044
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	desc = {
		trigger = { FROM = { has_character_flag = began_revolt } }
		text = EVTDESC_TOG_1044A
	}
	desc = {
		trigger = { FROM = { NOT = { has_character_flag = began_revolt } } }
		text = EVTDESC_TOG_1044B
	}

	is_triggered_only = yes

	ai = no

	option = {
		name = CURSES
	}
}

# Nationalists seize a holding. Fired from 'on_siege_over_winner'.
character_event = {
	id = TOG.1045

	is_triggered_only = yes # on_siege_over_winner
	hide_window = yes

	trigger = {
		FROM = {
			is_capital = yes # The capital holding
		}

		any_war = {
			using_cb = liberation_revolt

			any_attacker = {
				OR = {
					character = ROOT
					is_liege_of = ROOT
				}
			}
		}
	}

	immediate = {
		FROM = {
			location = {
				if = {
					limit = { culture = ROOT }

					if = {
						limit = {
							NOT = { has_province_modifier = cultural_unrest }
						}

						add_province_modifier = {
							name = cultural_unrest
							years = 2
						}
					}
				}
				else_if = {
					limit = {
						kingdom = { culture = ROOT }
					}

					random = {
						chance = 20
						culture = ROOT
					}
				}
			}
		}
	}
}

# Nationalist Rebels rise up to reinforce an ongoing revolt
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1050
	desc = EVTDESC_TOG_1050
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		if = {
			limit = { has_province_modifier = cultural_unrest }
			remove_province_modifier = cultural_unrest
		}

		owner = {
			top_liege = {
				any_war = {
					limit = {
						using_cb = liberation_revolt
						defender = { character = PREVPREV }
						ROOT = { de_jure_liege_or_above = thirdparty_title_scope }
					}

					attacker = {
						spawn_nationalist_reinforcements_effect = yes

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = powerful
								}
							}

							spawn_nationalist_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = very_powerful
								}
							}
							spawn_nationalist_reinforcements_effect = yes
							spawn_nationalist_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = extremely_powerful
								}
							}
							spawn_nationalist_reinforcements_effect = yes
							spawn_nationalist_reinforcements_effect = yes
							spawn_nationalist_reinforcements_effect = yes
						}
					}
				}
			}

			any_liege = { # Inform the lieges
				character_event = { id = TOG.1051 }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1000
	}
}

character_event = {
	id = TOG.1051
	desc = EVTDESC_TOG_1051
	picture = GFX_evt_siege
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1000
	}
}

# Dealing with the province where the rebellion started
# TODO: Consider firing on_war_ended_<any> instead?
province_event = {
	id = TOG.1052

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_province_modifier = rebellion_nationalist_province

		owner = {
			top_liege = {
				NOT = {
					any_war = {
						defender = { character = PREVPREV }
						using_cb = liberation_revolt
					}
				}
			}
		}
	}

	fail_trigger_effect = {
		# Try again tomorrow
		repeat_event = {
			id = TOG.1052
			days = 1
		}
	}

	immediate = {
		remove_province_modifier = rebellion_nationalist_province

		if = {
			limit = {
				kingdom = { culture = ROOT }
				NOT = { culture = top_liege }
			}

			remove_province_modifier = recent_county_uprising

			top_liege = {
				character_event = { id = TOG.1053 }
			}
		}
	}
}

character_event = {
	id = TOG.1053
	desc = EVTDESC_TOG_1053
	picture = GFX_evt_riots_byzantine
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	immediate = {
		log = "[Root.GetTitledName] receives option to deal with [From.GetName], where Nationalist rebellion began"
	}

	option = {
		name = EVTOPTA_TOG_1053 # Teach them a lesson

		trigger = {
			NOT = { has_law = culture_conversion_0 }
		}

		tyrant_plus_1_effect = yes

		random = {
			chance = 50
			add_trait_partially_wroth_effect = yes
		}

		random = {
			chance = 25
			remove_trait_kind_effect = yes
		}

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = rebellion_lesson
				years = 5
			}

			random_list = {
				25 = { culture = ROOT }

				75 = {
					add_province_modifier = {
						name = recent_county_uprising
						years = 10
					}
				}
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_CULTURE

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					culture = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 2
				}
			}
		}

		ai_chance = {
			factor = 30

			trigger = {
				trigger_if = {
					limit = {
						OR = {
							trait = tyrant4
							trait = tyrant5
						}
					}

					OR = {
						trait = lunatic
						trait = possessed
					}
				}
			}

			mult_modifier = {
				factor = 0.1

				OR = {
					trait = patient
					trait = kind
				}
			}

			mult_modifier = {
				factor = 0.25

				OR = {
					trait = tyrant1
					trait = tyrant2
					trait = tyrant3
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}
		}
	}

	option = {
		name = EVTOPTB_TOG_1053 # Do whatever it takes

		trigger = {
			NOT = { has_law = culture_conversion_0 }
		}

		tyrant_plus_2_effect = yes

		random = {
			chance = 50
			add_trait_partially_wroth_effect = yes
		}

		remove_trait_silently_patient_effect = yes

		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		else_if = {
			limit = { NOT = { trait = cruel } }

			random = {
				chance = 50
				add_trait_cruel_effect = yes
			}
		}

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = rebellion_reprisal
				years = 5
			}

			random_list = {
				50 = { culture = ROOT }

				50 = {
					add_province_modifier = {
						name = recent_county_uprising
						years = 20
					}
				}
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_CULTURE

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					culture = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 3
				}
			}
		}

		ai_chance = {
			factor = 10

			trigger = {
				NOR = {
					trait = patient
					trait = kind
				}

				trigger_if = {
					limit = {
						OR = {
							trait = tyrant4
							trait = tyrant5
						}
					}

					OR = {
						trait = lunatic
						trait = possessed
					}
				}
			}

			mult_modifier = {
				factor = 2
				trait = cruel
			}
		}
	}

	option = {
		name = EVTOPTC_TOG_1053 # We will find another way

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = recent_county_uprising
				years = 5
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_CULTURE

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					culture = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 1
				}
			}
		}

		ai_chance = {
			factor = 60

			mult_modifier = {
				factor = 0.5
				trait = cruel
			}

			mult_modifier = {
				factor = 0.5
				trait = wroth
			}

			mult_modifier = {
				factor = 1.5

				OR = {
					trait = tyrant1
					trait = tyrant2
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 2

				OR = {
					trait = tyrant3
					trait = tyrant4
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 3

				trait = tyrant5

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}
		}
	}
}

# Nationalist revolter is no longer part of the war
character_event = {
	id = TOG.1054

	hide_window = yes

	has_character_flag = nationalist_rebel

	trigger = {
		trigger_if = {
			limit = { is_ruler = yes }

			trigger_if = {
				limit = { independent = yes }

				NOT = {
					any_war = {
						using_cb = liberation_revolt
						any_attacker = { character = ROOT }
					}
				}
			}
			trigger_else = {
				liege = {
					NOT = {
						any_war = {
							using_cb = liberation_revolt

							attacker = {
								is_liege_of = ROOT
								culture_group = ROOT
							}
						}
					}
				}
			}
		}
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		log = "WARNING: [Root.GetBestName] is no longer part of a nationalist revolt -- reverting status"
		clr_character_flag = nationalist_rebel

		if = {
			limit = { has_any_opinion_modifier = liberation_revolt_against }

			random_opinion_modifier_target = {
				limit = {
					reverse_has_opinion_modifier = {
						name = liberation_revolt_against
						who = ROOT
					}
				}

				reverse_remove_opinion = {
					name = liberation_revolt_against
					who = ROOT
				}

				if = {
					limit = { higher_real_tier_than = ROOT }
					set_defacto_vassal = ROOT
				}
			}
		}
	}
}

# Nationalist revolter dies
character_event = {
	id = TOG.1055

	is_triggered_only = yes
	hide_window = yes

	only_playable = yes

	trigger = {
		OR = {
			has_character_flag = nationalist_rebel
			has_any_opinion_modifier = liberation_revolt_against
		}
	}

	immediate = {
		if = {
			limit = { primary_title = { is_vice_royalty = yes } }

			capital_scope = {
				county = {
					current_heir = {
						save_event_target_as = liberation_heir
					}
				}
			}
		}
		else = {
			primary_title = {
				current_heir = {
					save_event_target_as = liberation_heir
				}
			}
		}

		# Check if heir should inherit revolt status
		if = {
			limit = {
				event_target:liberation_heir = {
					culture = ROOT
					in_revolt = no

					OR = {
						is_ruler = no
						has_character_flag = nationalist_rebel
						any_liege = { has_character_flag = nationalist_rebel }
					}
				}
			}

			event_target:liberation_heir = {
				set_character_flag = nationalist_rebel

				if = {
					limit = {
						ROOT = { has_any_opinion_modifier = liberation_revolt_against }
						NOT = { has_any_opinion_modifier = liberation_revolt_against }
					}

					ROOT = {
						random_opinion_modifier_target = {
							limit = {
								reverse_has_opinion_modifier = {
									name = liberation_revolt_against
									who = PREV
								}
							}

							reverse_opinion = {
								name = liberation_revolt_against
								who = PREVPREV
							}
						}
					}
				}
			}
		}
		else = {
			# Failing that, end the war or re-vassalize to former liege
			if = {
				limit = {
					any_war = {
						using_cb = liberation_revolt
						attacker = { character = ROOT }
					}
				}

				any_war = {
					limit = {
						using_cb = liberation_revolt
						attacker = { character = ROOT }
					}

					end_war = invalid
				}
			}
			else_if = {
				limit = { has_any_opinion_modifier = liberation_revolt_against }

				random_opinion_modifier_target = {
					limit = {
						reverse_has_opinion_modifier = {
							name = liberation_revolt_against
							who = ROOT
						}
					}

					reverse_remove_opinion = {
						name = liberation_revolt_against
						who = ROOT
					}

					set_defacto_vassal = ROOT
				}
			}
			else_if = {
				limit = {
					independent = no

					liege = {
						any_war = {
							using_cb = liberation_revolt
							attacker = { character = PREVPREV }
						}
					}
				}

				liege = {
					any_war = {
						limit = {
							using_cb = liberation_revolt
							attacker = { character = PREVPREV }
						}

						defender = {
							set_defacto_vassal = ROOT
						}
					}
				}
			}
		}
	}
}

### RELIGIOUS REBELS

# Religious Rebels rise up (temporary rebel title created, with a leader and a war)
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1060
	desc = EVTDESC_TOG_1060
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		if = {
			limit = {
				has_province_modifier = recent_bon_conversion

				top_liege = {
					OR = {
						religion = bon_pagan_reformed
						religion = buddhist
					}
				}
			}

			religion = bon_pagan
			remove_province_modifier = recent_bon_conversion
		}

		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		top_liege = {
			save_event_target_as = province_top_liege
		}

		duchy = {
			save_event_target_as = province_duchy
		}

		create_character = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 32
			add_trait = zealous
			add_trait = scholar
			add_trait = skilled_tactician

			attributes = {
				martial = 7
				learning = 7
			}
		}

		new_character = {
			set_character_flag = religious_revolter

			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				rebel = yes
				culture = ROOT
				name = HERETIC_REVOLT
				holder = THIS
			}

			spawn_religious_army_effect = yes
			wealth = 100

			if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = powerful
					}
				}

				spawn_religious_army_effect = yes
				wealth = 150
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = very_powerful
					}
				}
				spawn_religious_army_effect = yes
				spawn_religious_army_effect = yes
				wealth = 250
			}
			else_if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = extremely_powerful
					}
				}
				spawn_religious_army_effect = yes
				spawn_religious_army_effect = yes
				spawn_religious_army_effect = yes
				wealth = 350
			}

			# DoW on the province top liege
			war = {
				target = event_target:province_top_liege
				casus_belli = religious_revolt
				thirdparty_title = event_target:province_duchy
			}

			opinion = {
				name = opinion_evil_tyrant
				who = event_target:province_top_liege
			}
		}

		owner = {
			any_liege = { # Inform the lieges
				character_event = { id = TOG.1061 }
			}
		}

		if = {
			limit = { has_province_modifier = religious_unrest }
			remove_province_modifier = religious_unrest
		}
	}

	option = {
		name = {
			text = EVTOPTA_TOG_1060
			trigger = { religion_group = owner }
		}
		name = {
			text = EVTOPTB_TOG_1060
			trigger = { NOT = { religion_group = owner } }
		}
	}
}

character_event = {
	id = TOG.1061
	desc = EVTDESC_TOG_1061
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = {
			text = EVTOPTA_TOG_1060
			trigger = { religion_group = FROM }
		}
		name = {
			text = EVTOPTB_TOG_1060
			trigger = { NOT = { religion_group = FROM } }
		}
	}
}

# Religious Rebels seize a holding. Fired from 'on_siege_over_winner'. Owner of the winning unit is ROOT. The taken Holding title is in FROM.
character_event = {
	id = TOG.1065

	is_triggered_only = yes # on_siege_over_winner
	hide_window = yes

	trigger = {
		has_character_flag = religious_revolter
		rebel = yes

		FROM = {
			is_capital = yes # The capital holding
		}
	}

	immediate = {
		FROM = {
			location = {
				if = {
					limit = {
						NOT = { religion = ROOT }
					}

					random = {
						chance = 5
						religion = ROOT
					}
				}

				if = {
					limit = {
						NOT = { has_province_modifier = religious_unrest }
					}

					add_province_modifier = {
						name = religious_unrest
						years = 2
					}
				}
			}
		}
	}
}

# Religious Rebels rise up to reinforce an ongoing religious uprising
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1070
	desc = EVTDESC_TOG_1070
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_rebel_revolt via TOG.999

	immediate = {
		if = {
			limit = { has_province_modifier = religious_unrest }
			remove_province_modifier = religious_unrest
		}

		add_province_modifier = {
			name = recent_county_uprising # -100% revolt risk
			years = 5
		}

		owner = {
			top_liege = {
				any_war = {
					limit = {
						using_cb = religious_revolt
						defender = { character = PREVPREV }
						attacker = { religion = ROOT }
					}

					attacker = {
						spawn_religious_reinforcements_effect = yes

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = powerful
								}
							}

							spawn_religious_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = very_powerful
								}
							}
							spawn_religious_reinforcements_effect = yes
							spawn_religious_reinforcements_effect = yes
						}
						else_if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = extremely_powerful
								}
							}
							spawn_religious_reinforcements_effect = yes
							spawn_religious_reinforcements_effect = yes
							spawn_religious_reinforcements_effect = yes
						}
					}
				}
			}

			any_liege = { # Inform the lieges
				character_event = { id = TOG.1071 }
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1070
	}
}

character_event = {
	id = TOG.1071
	desc = EVTDESC_TOG_1071
	picture = GFX_evt_heretic
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1070
	}
}

# Dealing with the province where the rebellion started
province_event = {
	id = TOG.1072

	is_triggered_only = yes
	hide_window = yes

	trigger = {
		has_province_modifier = rebellion_religion_province
	}

	immediate = {
		remove_province_modifier = rebellion_religion_province

		if = {
			limit = {
				is_heretic = no
				NOT = { religion_group = top_liege }
			}

			remove_province_modifier = recent_county_uprising

			top_liege = {
				character_event = { id = TOG.1073 }
			}
		}
	}
}

character_event = {
	id = TOG.1073
	desc = EVTDESC_TOG_1073
	picture = GFX_evt_peasants
	border = GFX_event_normal_frame_religion

	is_triggered_only = yes

	immediate = {
		log = "[Root.GetTitledName] receives option to deal with [From.GetName], where Religious rebellion began"
	}

	option = {
		name = EVTOPTA_TOG_1073 # Teach them a lesson

		tyrant_plus_1_effect = yes

		random = {
			chance = 50
			add_trait_partially_wroth_effect = yes
		}

		random = {
			chance = 25
			remove_trait_kind_effect = yes
		}

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = rebellion_lesson
				years = 5
			}

			random_list = {
				25 = { religion = ROOT }

				75 = {
					add_province_modifier = {
						name = recent_county_uprising
						years = 10
					}
				}
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_RELIGION

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					religion = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 2
				}
			}
		}

		ai_chance = {
			factor = 30

			trigger = {
				trigger_if = {
					limit = { trait = tyrant5 }

					OR = {
						trait = lunatic
						trait = possessed
					}
				}
			}

			mult_modifier = {
				factor = 0.1

				OR = {
					trait = patient
					trait = kind
				}
			}

			mult_modifier = {
				factor = 0.25

				trait = tyrant4

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}
		}
	}

	option = {
		name = EVTOPTB_TOG_1073 # Do whatever it takes

		tyrant_plus_2_effect = yes

		if = {
			limit = { trait = patient }
			remove_trait = patient
		}
		else_if = {
			limit = { NOT = { trait = wroth } }

			random = {
				chance = 50
				add_trait_wroth_effect = yes
			}
		}

		if = {
			limit = { trait = kind }
			remove_trait = kind
		}
		else_if = {
			limit = { NOT = { trait = cruel } }

			random = {
				chance = 50
				add_trait_cruel_effect = yes
			}
		}

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = rebellion_reprisal
				years = 5
			}

			random_list = {
				50 = { religion = ROOT }

				50 = {
					add_province_modifier = {
						name = recent_county_uprising
						years = 20
					}
				}
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_RELIGION

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					religion = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 3
				}
			}
		}

		ai_chance = {
			factor = 10

			trigger = {
				NOR = {
					trait = patient
					trait = kind
				}

				trigger_if = {
					limit = {
						OR = {
							trait = tyrant4
							trait = tyrant5
						}
					}

					OR = {
						trait = lunatic
						trait = possessed
					}
				}
			}

			mult_modifier = {
				factor = 2
				trait = cruel
			}
		}
	}

	option = {
		name = EVTOPTC_TOG_1073 # We will find another way

		FROM = {
			show_scope_change = no

			add_province_modifier = {
				name = recent_county_uprising
				years = 5
			}
		}

		custom_tooltip = {
			text = TOOLTIP_RECENT_COUNTY_UPRISING_RELIGION

			any_realm_province = {
				limit = {
					owner = {
						OR = {
							character = ROOT
							is_vassal_or_below_of = ROOT
						}
					}

					religion = FROM
					held_under_PREV = yes

					NOR = {
						province_id = FROM
						has_province_modifier = recent_county_uprising
					}
				}

				add_province_modifier = {
					name = recent_county_uprising
					years = 1
				}
			}
		}

		ai_chance = {
			factor = 60

			mult_modifier = {
				factor = 0.5
				trait = cruel
			}

			mult_modifier = {
				factor = 0.5
				trait = wroth
			}

			mult_modifier = {
				factor = 0.5
				trait = zealous
			}

			mult_modifier = {
				factor = 1.5

				OR = {
					trait = tyrant1
					trait = tyrant2
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 2

				OR = {
					trait = tyrant3
					trait = tyrant4
				}

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}

			mult_modifier = {
				factor = 3

				trait = tyrant5

				NOR = {
					trait = lunatic
					trait = possessed
				}
			}
		}
	}
}

### DECADENCE REBELS

# Decadence Rebels rise up (temporary rebel title created, with a leader and a war)
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1080
	desc = EVTDESC_TOG_1080
	picture = GFX_evt_bishop_muslim
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	immediate = {
		add_province_modifier = {
			name = recent_county_uprising
			years = 10 # Ten years of -100% revolt risk in this county
		}

		remove_province_modifier = decadence_unrest

		top_liege = {
			set_character_flag = has_current_revolt
			save_event_target_as = province_top_liege
		}

		create_character = {
			random_traits = yes
			dynasty = none
			religion = ROOT
			culture = ROOT
			female = no
			age = 32
			health = 7

			attributes = {
				martial = 8
				diplomacy = 8
			}

			add_trait = just
			add_trait = brave
			add_trait = ambitious
			add_trait = brilliant_strategist
		}

		new_character = {
			set_character_flag = decadence_revolter
			save_event_target_as = revolt_leader

			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				rebel = yes
				culture = ROOT
				name = DECADENCE_REVOLT
				holder = THIS
				ruler = ""
				ruler_female = ""
			}

			wealth = 100
			spawn_decadence_army_effect = yes

			if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = powerful
					}
				}
				spawn_decadence_army_effect = yes
				wealth = 150
			}

			if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = very_powerful
					}
				}
				spawn_decadence_army_effect = yes
				spawn_decadence_army_effect = yes
				wealth = 250
			}

			if = {
				limit = {
					has_game_rule = {
						name = provincial_revolt_strength
						value = extremely_powerful
					}
				}
				spawn_decadence_army_effect = yes
				spawn_decadence_army_effect = yes
				spawn_decadence_army_effect = yes
				wealth = 350
			}

			# DoW on the province top liege
			war = {
				target = event_target:province_top_liege
				casus_belli = decadence_revolt
				thirdparty_title = ROOT # The county
			}

			opinion = {
				name = opinion_evil_tyrant
				who = event_target:province_top_liege
			}
		}

		owner = {
			any_liege = { # Inform the lieges
				character_event = { id = TOG.1081 }
			}
		}
	}

	option = {
		name = CURSES
	}
}

character_event = {
	id = TOG.1081
	desc = EVTDESC_TOG_1081
	picture = GFX_evt_bishop_muslim
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	option = {
		name = CURSES
	}
}

# Decadence rebels seize a holding. Fired from 'on_siege_won_leader'.
character_event = {
	id = TOG.1085

	hide_window = yes
	is_triggered_only = yes

	trigger = {
		FROM = {
			location = {
				is_capital = yes # The capital holding
			}
		}

		religion_group = muslim

		any_war = {
			using_cb = decadence_revolt

			any_attacker = {
				religion_group = ROOT

				OR = {
					character = ROOT
					is_liege_of = ROOT
				}
			}
		}
	}

	immediate = {
		FROM = {
			location = {
				if = {
					limit = {
						religion_group = ROOT
						NOT = { has_province_modifier = decadence_unrest }
					}

					add_province_modifier = {
						name = decadence_unrest
						years = 2
					}
				}
			}
		}
	}
}

# Decadence Rebels rise up to reinforce an ongoing revolt
# Triggered from "on_rebel_revolt"
province_event = {
	id = TOG.1090
	desc = EVTDESC_TOG_1090
	picture = GFX_evt_bishop_muslim
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_province_modifier = decadence_unrest }
			remove_province_modifier = decadence_unrest
		}

		add_province_modifier = {
			name = recent_county_uprising
			years = 10 # Ten years of -100% revolt risk in this county
		}

		owner = {
			top_liege = {
				any_war = {
					limit = {
						using_cb = decadence_revolt
						defender = { character = PREVPREV }

						attacker = {
							religion_group = muslim
							religion_group = ROOT
						}
					}

					attacker = {
						spawn_decadence_reinforcements_effect = yes

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = powerful
								}
							}
							spawn_decadence_reinforcements_effect = yes
						}

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = very_powerful
								}
							}
							spawn_decadence_reinforcements_effect = yes
							spawn_decadence_reinforcements_effect = yes
						}

						if = {
							limit = {
								has_game_rule = {
									name = provincial_revolt_strength
									value = extremely_powerful
								}
							}
							spawn_decadence_reinforcements_effect = yes
							spawn_decadence_reinforcements_effect = yes
							spawn_decadence_reinforcements_effect = yes
						}
					}
				}
			}

			any_liege = { # Inform the lieges
				character_event = { id = TOG.1091 }
			}
		}
	}

	option = {
		name = CURSES
	}
}

character_event = {
	id = TOG.1091
	desc = EVTDESC_TOG_1091
	picture = GFX_evt_bishop_muslim
	border = GFX_event_normal_frame_war

	is_triggered_only = yes

	ai = no

	option = {
		name = CURSES
	}
}


### REBELS KILL CHARACTER AFTER SIEGE

# Rebels kill a local character. Fired from 'on_siege_over_loc_chars'.
# Siege winner unit owner in the 'new_character' scope, lost holding title in FROM, local character in ROOT.
character_event = {
	id = TOG.1190
	desc = EVTDESC_TOG_1190
	picture = GFX_evt_beheading
	border = GFX_event_normal_frame_war

	is_triggered_only = yes # on_siege_over_loc_chars, random_events

	trigger = {
		new_character = {
			rebel = yes

			trigger_if = {
				limit = { religion = ROOT }

				OR = {
					has_character_flag = heretic_revolter
					has_character_flag = religious_revolter
					has_character_flag = shepherds_crusade_leader
				}
			}
		}
	}

	weight_multiplier = {
		factor = 1

		mult_modifier = {
			factor = 0.5
			is_female = yes
		}

		mult_modifier = {
			factor = 0.5
			is_adult = no
		}

		mult_modifier = {
			factor = 0.9
			intrigue >= 10
		}

		mult_modifier = {
			factor = 0.9
			intrigue >= 12
		}

		mult_modifier = {
			factor = 0.9
			intrigue >= 14
		}

		mult_modifier = {
			factor = 0.9
			intrigue >= 16
		}

		mult_modifier = {
			factor = 0.9
			intrigue >= 18
		}

		mult_modifier = {
			factor = 0.9
			intrigue >= 20
		}
	}

	immediate = {
		any_liege = { # Inform the victim's lieges
			character_event = { id = TOG.1191 }
		}

		new_character = {
			ROOT = {
				death = {
					death_reason = death_rabble
					# killer = PREV
				}
			}
		}
	}

	option = {
		name = EVTOPTA_TOG_1190
	}
}


# Lieges informed
character_event = {
	id = TOG.1191
	picture = GFX_evt_beheading
	desc = EVTDESC_TOG_1191
	border = GFX_event_normal_frame_war

	is_triggered_only = yes
	notification = yes

	ai = no

	option = {
		name = EVTOPTA_TOG_1191
	}
}